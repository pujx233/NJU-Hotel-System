# 互联网酒店预订系统软件体系结构描述文档

## 文档修改历史

| 修改人员 | 日期          | 修改原因                           | 版本号 |
| :------: | ------------- | ---------------------------------- | ------ |
|  曾昭宁  | 2020年4月22日 | 调整文档模板格式，完成目录和1，2节 | v0     |
|  陈鹏克  | 2020年4月23日 | 完成3，4.1                         | v1     |
|  陈鹏克  | 2020年4月24日 | 修改4.1                            | v2     |
|  陈鹏克  | 2020年4月24日 | 修改4.1                            | v3      |
|  浦隽轩  | 2020年4月25日 | 完成4.2、4.3、6                      |v4      |
|  檀潮  | 2020年4月25日 | 完成5.3、5.4                      |v5      |
| 曾昭宁 | 2020年4月25日 | 完成5.1、5.2 |v6 |
| 曾昭宁 | 2020年6月10日 | 修改 4.1 |v7 |
| 陈鹏克 | 2020年6月11日 | 修改5.1、5.2 |v8 |
| 檀潮 | 2020年6月14日 | 修改5.3、5.4 |v9 |
| 曾昭宁 | 2020年6月15日 | 修改相关包图 |v10 |
| 浦隽轩 | 2020年6月25日 | 修改数据库表 |v11 |
| 曾昭宁 | 2020年6月29日 | 检验修改 |v12 |

## 目录
1. **引言**
    1.1 编制目的
    1.2 词汇表
    1.3 参考资料
2. **产品概述**
3. **逻辑视图**
4. **组合视图**
    4.1 开发包图
    4.2 运行时进程
    4.3 物理部署
5. **架构设计(接口视角)**
    5.1 模块职责
      5.1.1 模块视图
      5.1.2 各层职责
      5.1.3 层之间调用接口
    5.2 用户界面层
      5.2.1 职责
      5.2.2 接口规范
      5.2.3 用户界面模块设计原理
    5.3 业务逻辑层分解
      5.3.1 职责
      5.3.2 接口规范
    5.4 数据层分解
      5.4.1 职责
      5.4.2 接口规范
6. **信息视角**
    6.1 数据持久化对象
    6.2 数据库表


## 1. 引言

### 1.1 编制目的

本文档完成对互联网酒店预订系统的体系结构设计，用以指导详细设计和开发的目的，同时实现和测试人员和测试人员的沟通。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注 |
| :------: | -------- | ---- |
|          |          |      |

### 1.3 参考资料

1）互联网酒店预订系统软件需求规格说明文档

## 2. 产品概述

该互联网酒店预订系统可以辅助酒店掌握客户行程变化、帮助酒店和客户的长途沟通、减少客户恶意预订、帮助客户了解酒店信息和为客户保存过去的酒店体验历史。其基本功能包括：客户查看，维护个人信息；客户搜索酒店信息；客户注册会员；酒店工作人员查看订单；订单执行；制定网站促销策略；制定酒店促销策略。

该系统期望为提高酒店的订单处理效率、降低人力资源消耗、提高酒店的订单量和利润、减少客户异地预订酒店所需的时间并简化预订流程。

参考《互联网酒店预订系统软件需求规格说明文档》中的 2.总体描述。

## 3. 逻辑视图

互联网预定酒店系统中，选择了分层体系结构风格，将系统分为3层（展示层、业务逻辑层、数据层）能够很好地示意整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如图1和图2所示。

![逻辑视角](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E9%80%BB%E8%BE%91%E8%A7%86%E8%A7%92.png)

​                                                          图1	参照体系结构风格的包图表达逻辑视角

![设计方案](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E9%80%BB%E8%BE%91%E5%8C%85%E5%9B%BE%EF%BC%88%E6%96%B0%EF%BC%89.png)

​                                                                       图2	软件体系结构逻辑设计方案

## 4. 组合视图

### 4.1 开发包图

互联网预订酒店系统的最终开发包设计如表1所示。

​                                                      表1	互联网预定酒店系统的最终开发包设计

| 开发（物理）包      | 依赖的其他开发包                                             |
| ------------------- | ------------------------------------------------------------ |
| api                 | controller,vo,utils                                          |
| api.admin           | controller.admin                                             |
| api.coupon          | controller.coupon                                            |
| api.hotel           | controller.hotel                                             |
| api.hotelManager    | controller.hotel                                             |
| api.order           | controller.order                                             |
| api.user            | controller.user                                              |
| api.VIP             | controller.VIP                                               |
| api.marketer        | controller.marketer                                          |
| api.rar             | controller.rar                                               |
| asserts             |                                                              |
| views               | api,vo，store,router                                         |
| views.admin         | api.admin                                                    |
| views.hotel         | api.hotel,api.coupon,api.order,api.rar                       |
| views.hotelManeger  | api.hotelManager,api.coupon,api.order                        |
| views.user          | api.user,api.order,api.VIP                                   |
| views.marketer      | api.order,api.VIP,api.marketer                               |
| enums               |                                                              |
| config              |                                                              |
| util                |                                                              |
| store               |                                                              |
| router              |                                                              |
| componenets         |                                                              |
| controller          | restapi,po,vo,bl                                             |
| bl                  | vo,po                                                        |
| bllmpl              | bl,vo,data,po                                                |
| data                | po                                                           |
| datalmpl            | data, po                                                     |
| controller.admin    | restapi,bl.admin,po,vo                                       |
| bllmpl.admin        | bl.admin, bl.hotel, data.admin, data.user, util, po,vo       |
| bl.admin            | po,vo                                                        |
| data.admin          | po                                                           |
| datalmpl.admin      | data.admin,po                                                |
| controller.coupon   | restapi,bl.coupon,vo                                         |
| bllmpl.coupon       | bl.coupon, bl.hotel, data.coupon, data.VIP, po,vo            |
| bl.coupon           | po,vo                                                        |
| data.coupon         | poo                                                          |
| datalmpl.coupon     | data.coupon,po                                               |
| controller.hotel    | restapi,bl.hotel,po,vo                                       |
| bllmpl.hotel        | bl.hotel, bl.order, bl.user, data.hotel, po,vo, enums, util  |
| bl.hotel            | po,vo, util,                                                 |
| data.hotel          | po, enums                                                    |
| datalmpl.hotel      | data.hotel,po                                                |
| controller.order    | restapi,bl.order,po,vo                                       |
| bllmpl.order        | bl.order, bl.user, bl.hotel, bl.vip, data.order,  po,vo, enums |
| bl.order            | po,vo, util                                                  |
| data.order          | po                                                           |
| datalmpl.order      | data.order,po                                                |
| controller.user     | restapi,bl.user,po,vo                                        |
| bllmpl.user         | bl.user,data.user,po,vo, util                                |
| bl.user             | po,vo                                                        |
| data.user           | po                                                           |
| datalmpl.user       | data.user,po                                                 |
| controller.VIP      | restapi,bl.VIP,po,vo                                         |
| bllmpl.VIP          | bl.VIP, bl.user, data.VIP, po, vo, enums, util               |
| bl.VIP              | po,vo,enums, util                                            |
| data.VIP            | po,enums                                                     |
| datalmpl.VIP        | data.VIP,po                                                  |
| controller.marketer | restapi,bl.marketer,po,vo                                    |
| bllmpl.marketer     | bl.marketer, bl.VIP, bl.order, data.marketer, data.order, data.user, po, vo, util, enums |
| bl.marketer         | po,vo                                                        |
| data.marketer       | po                                                           |
| datalmpl.marketer   | data.marketer,po                                             |
| controller.rar      | restapi,bl.rar,po,vo                                         |
| bllmpl.rar          | bl.rar,bl.order,data.rar, data.order, po,vo, enums           |
| bl.rar              | po,vo                                                        |
| data.rar            | po                                                           |
| datalmpl.rar        | data.rar,po                                                  |
| vo                  |                                                              |
| po                  |                                                              |
| restapi             |                                                              |

互联网预订酒店系统前端开发包图如图3所示，后端开发包图如图4所示。

![前端开发包图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE%EF%BC%88%E6%96%B0%EF%BC%89.png)

​                                                               图3	互联网预订酒店系统前端开发包图

![后端开发包图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE%EF%BC%88%E6%96%B0%EF%BC%89.png)

​                                                                图4	互联网预订酒店系统后端开发包图

### 4.2 运行时进程

- 表示软件在运行时进程间的交互，描述系统的动态结构

  - 在互联网预订酒店系统中，会有多个客户端进程和一个服务器端进程。结合部署图,客户
端进程是在客户端机器上运行，服务器端进程在服务器端机器上运行。
  - 进程图

  ![2.jpg](https://i.loli.net/2020/04/25/sqaAXg2GtfiNwWF.jpg)



### 4.3 物理部署

- 处理如何将软件组件映射到硬件基础设施
  - 互联网预订酒店系统中客户端构件是放在客户端机器上,服务器端构件是放在服务器端机器上。在客户端节点上,还要部署HttpStub构件。由于Java Http构件属于JDK6.0的一部分。所以，在系统JDK环境已经设置好的情况下，不需要再独立部署。


  - 部署图

![物理部署.png](https://i.loli.net/2020/06/11/4KhLagJmouO6zc8.png)

## 5. 架构设计(接口视角)

### 5.1 模块职责

#### 5.1.1 模块视图

客户端模块和服务器模块视图分别如图7和图8所示。客户端各层和服务器端各层的职责分别如表2和表3所示。

![客户端模块视图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.png)
![服务器端模块视图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E5%9D%97%E8%A7%86%E5%9B%BE.png)



#### 5.1.2 各层职责

​                                                                表2 客户端各层的职责

|       层       | 职责                               |
| :------------: | ---------------------------------- |
|     展示层     | 在浏览器上展现客户端用户界面       |
| 客户端网络模块 | 使用http协议与服务器端进行网络通讯 |
|    启动模块    | 初始化网络通信机制，启动用户界面   |

​                                                                表3 服务器端各层的职责

|        层        | 职责                                         |
| :--------------: | -------------------------------------------- |
| 服务器端网络模块 | 通过http协议与客户端进行通讯                 |
|    业务逻辑层    | 对于用户界面的输入进行响应并进行业务逻辑处理 |
|      数据层      | 负责数据的持久化和数据访问接口               |
|     启动模块     | 负责初始化网络通信机制，启动用户界面         |

#### 5.1.3 层之间调用接口

每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层与层之间接口的调用如表4所示。

​                                                      表4	层与层之间的调用接口

|                             接口                             | 服务调用方         | 服务提供方         |
| :----------------------------------------------------------: | ------------------ | ------------------ |
| AdminService<br>CouponMatchStrategy<br>CouponService<br>HotelService<br>RoomService<br>OrderService<br>AccountService<br>VIPService<br>MarketService | 客户端展示层       | 服务器端业务逻辑层 |
| AdminMapper<br>CouponMapper<br>HotelMapper<br>RoomMapper<br>OrderMapper<br>AccountMapper<br>VIPMapper<br>MarketMapper | 服务器端业务逻辑层 | 服务器端数据层     |

以网站管理人员账号管理为例，如图9所示，每一层之间都是由上层依赖了一个接口（需接口），而下层实现这个接口（公接口）。AdminService提供了Admin界面所需要的所有业务逻辑功能。AdminMapper提供了对数据库的增、查操作。通过接口降低了层与层之间的耦合。

![网站管理人员账号管理层之间接口的调用](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E7%BD%91%E7%AB%99%E7%AE%A1%E7%90%86%E4%BA%BA%E5%91%98%E8%B4%A6%E5%8F%B7%E7%AE%A1%E7%90%86%E5%B1%82%E4%B9%8B%E9%97%B4%E6%8E%A5%E5%8F%A3%E7%9A%84%E8%B0%83%E7%94%A8.png)

​                                                                图9 网站管理人员账号管理层之间调用的接A口

### 5.2 用户界面层分解

根据需求，系统存在19个用户界面：网站主页面、登陆界面；用户：个人信息界面、浏览酒店详细信息界面、酒店预订界面、客户订单查看界面、注册会员界面、预订历史查看界面、信用记录历史查看界面；酒店工作人员：个人信息界面、维护酒店基本信息界面、录入可用客房界面、制定酒店促销策略界面、查看订单界面；网站营销人员：网站营销人员主界面、制定网站促销策略界面、异常订单界面、信用充值界面；网站管理人员：用户管理界面。界面跳转如图所示。

![用户界面跳转图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E8%B7%B3%E8%BD%AC.png)

​                                                                图10 用户界面跳转

#### 5.2.1 职责

如表5所示为用户界面层模块的职责。

​                                                      表5	用户界面层模块的职责

|        模块        |                  职责                  |
| :----------------: | :------------------------------------: |
|     front_end      |       负责客户端界面的显示和跳转       |
|    views.admin     | 负责网站管理人员有关的界面的显示和交互 |
|    views.hotel     |     负责酒店有关的界面的显示和交互     |
| views.hotelManager | 负责酒店管理人员有关的界面的显示和交互 |
|     views.user     |     负责客户有关的界面的显示和交互     |
|   views.marketer   | 负责网站营销人员有关的界面的显示和交互 |

#### 5.2.2 接口规范

用户界面层模块提供的接口规范如表6所示。（接口由vue框架提供，无需自行定义）

​                                                      表6	用户界面层模块的接口规范

| 接口名  | 语法                       |
| :-----: | :-------------------------: |
| APP.vue |  **前置条件**：无           |
|           |  **后置条件**：显示用户界面  |

用户界面层需要的服务接口表如表7所示，需要的业务逻辑层服务如表8所示。

​                                                      表7	用户界面层模块直接需要的接口服务

|       服务名        | 服务                                         |
| :-----------------: | -------------------------------------------- |
|    api.admin.js     | 网站管理人员界面向后端发起数据请求的服务接口 |
|    api.coupin.js    | 优惠券界面向后端发起数据请求的服务接口       |
|    api.hotel.js     | 酒店界面向后端发起数据请求的服务接口         |
| api.hotelManager.js | 酒店管理人员界面向后端发起数据请求的服务接口 |
|    api.order.js     | 订单界面向后端发起数据请求的服务接口         |
|     api.user.js     | 客户界面向后端发起数据请求的服务接口         |
|     api.VIP.js      | VIP界面向后端发起数据请求的服务接口          |
|   api.marketer.js   | 网站营销人员界面向后端发起数据请求的服务接口 |
|     api.rar.js      | 酒店评论界面向后端发起数据请求的服务接口     |

​                                                      表8	用户界面层模块需要的业务逻辑层服务

|            服务名             | 服务                           |
| :---------------------------: | ------------------------------ |
|     bl.admin.AdminService     | 网站管理人员界面的业务逻辑接口 |
| bl.coupon.CouponMatchStrategy | 优惠券匹配的业务逻辑接口       |
|    bl.coupon.CouponService    | 优惠券界面的业务逻辑接口       |
|     bl.hotel.HotelService     | 酒店界面的业务逻辑接口         |
|     bl.hotel.RoomService      | 酒店房间界面的业务逻辑接口     |
|     bl.order.OrderService     | 订单界面的业务逻辑接口         |
|    bl.user.AccountService     | 客户界面的业务逻辑接口         |
|       bl.rar.RARService       | 酒店评论的业务逻辑接口         |
|       bl.vip.VIPService       | VIP的业务逻辑接口              |
|    bl.vip.MarketerService     | 网站营销人员的业务逻辑接口     |

#### 5.2.3 用户界面模块设计原理

用户界面利用html，css，javascript等web技术实现。



### 5.3 业务逻辑层分解
业务逻辑层包括多个针对界面的业务逻辑处理对象。业务逻辑层的设计如图11所示。
![业务逻辑层](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82%E7%9A%84%E8%AE%BE%E8%AE%A1.png)

​                                                      图11	业务逻辑层包含的模块

#### 5.3.1 职责

|         模块         | 职责                   |
| :--------------------: | ---------------------- |
| blImpl.admin | 负责实现网站管理人员界面所需要的服务 |
| blImpl.coupon | 负责实现优惠券界面所需要的服务 |
| blImpl.hotel | 负责实现酒店管理所需要的服务 |
| blImpl.marketer | 负责实现网站营销人员界面所需要的服务 |
| blImpl.order | 负责实现订单管理所需要的服务 |
| blImpl.rar | 负责实现评价界面所需要的服务 |
| blImpl.user | 负责实现用户账号管理所需要的服务 |
| blImpl.vip | 负责实现会员功能所需要的服务 |

​                                                      表9	业务逻辑层模块的职责

#### 5.3.2 接口规范

##### 5.3.2.1 blImpl.admin模块的接口规范
###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
| bl.admin.AdminService.addHotel | **语法:** public ResponseVO addHotel(HotelVO hotelVO, int adminId) |
|  | **前置条件:** adminid对应的用户是网站管理人员 |
|  | **后置条件:** 以hotelVO中的信息添加酒店，返回新酒店ID |
| bl.admin.AdminService.removeHotel | **语法:**  public ResponseVO removeHotel(Integer hotelId, Integer adminId) |
|  | **前置条件:** adminid对应的用户是网站管理人员，且hotelId对应的酒店存在 |
|  | **后置条件:** 删除对应的酒店 |
|bl.admin.AdminService.addManager| **语法:** public ResponseVO addManager(UserForm userForm, Integer hotelId) |
|        | **前置条件:** userForm中email与password符合输入规则 |
|        | **后置条件:** 以userForm中的信息添加酒店工作人员，返回添加结果 |
|bl.admin.AdminService.addMarketer| **语法:** public ResponseVO addMarketer(UserForm userForm) |
|        | **前置条件:** userForm中email与password符合输入规则 |
|        | **后置条件:** 以userForm中的信息添加网站营销人员，返回添加结果 |
|bl.admin.AdminService.getAllManagers| **语法:** public List&lt;User&gt; getAllManagers() |
|        | **前置条件:** 无 |
|        | **后置条件:** 返回所有酒店管理人员信息 |
|bl.admin.AdminService.getAllMarketers| **语法:** public List&lt;User&gt; getAllMarketers() |
|        | **前置条件:** 无 |
|        | **后置条件:** 返回所有网站营销人员信息 |
|bl.admin.AdminService.getAllClients| **语法:** public List&lt;User&gt; getAllClients() |
|        | **前置条件:** 无 |
|        | **后置条件:** 返回所有客户信息 |
|bl.admin.AdminService.updateUserInfo| **语法:** ResponseVO updateUserInfo(int userId, String password, String username, String phonenumber) |
|        | **前置条件:** 输入信息均符合格式 |
|        | **后置条件:** 根据输入查找用户并更新其信用值，返回更新成功与否的结果 |
|bl.admin.AdminService.removeUser| **语法:** ResponseVO removeUser(int userId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 删除根据输入查找到用户，返回删除成功与否的结果 |

​                                                                                               表10	blImpl.admin模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.hotel.HotelService.addHotel(HotelVO hotelVO) | 添加酒店 |
| bl.hotel.HotelService.removeHotel(Integer hotelId) | 根据ID删除酒店 |
| bl.hotel.HotelService.addHotelManager(Integer hotelId, Integer managerId) | 修改指定酒店的工作人员Id |
| bl.hotel.HotelService.retrieveHotels() | 获取所有酒店信息 |
| bl.hotel.HotelService.retrieveHotelDetails(Integer hotelId) | 根据ID查找酒店详细信息 |
| data.admin.AdminMapper.addManager(User user) | 插入单一持久化对象 |
| data.admin.AdminMapper.addMarketer(User user) | 插入单一持久化对象 |
| data.admin.AdminMapper.getAllManagers() | 查找多个持久化对象 |
| data.admin.AdminMapper.getAllMarketers() | 查找多个持久化对象 |
| data.admin.AdminMapper.getAllClients() | 查找多个持久化对象 |
| data.user.AccountMapper.getAccountByName(String email) | 根据email查找单一持久化对象 |
| data.user.AccountMapper.getAccountById(int id) | 根据ID查找单一持久化对象 |
| data.user.AccountMapper.deleteAccountById(int id) | 删除根据id查找到的单一持久化对象 |
| data.user.AccountMapper.updateAccount(int id, String password, String username, String phonenumber) | 改变根据ID查找到的单一持久化对象的属性 |

​                                                                                               表11	blImpl.admin需要的服务

##### 5.3.2.2 blImpl.coupon模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.coupon.CouponService.getMatchOrderCoupon| **语法:** List&lt;Coupon&gt; getMatchOrderCoupon(OrderVO orderVO)|
|        | **前置条件:** 订单填写完整 |
|        | **后置条件:** 根据订单信息，返回该订单可用的优惠策略列表 |
|bl.coupon.CouponService.getHotelAllCoupon| **语法:** List&lt;Coupon&gt; getHotelAllCoupon(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 根据ID查找并返回某个酒店提供的所有优惠策略（包括失效的） |
|bl.coupon.CouponService.addTargetMoneyCoupon| **语法:** CouponVO addTargetMoneyCoupon(TargetMoneyCouponVO couponVO) |
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加满减优惠策略，返回添加结果 |
|bl.coupon.CouponService.addTimeCoupon| **语法:** CouponVO addTimeCoupon(TimeCouponVO couponVO) |
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加限时优惠策略，返回添加结果 |
|bl.coupon.CouponService.addRoomsCoupon| **语法:** CouponVO addRoomsCoupon(RoomsCouponVO couponVO) |
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加多间优惠策略，返回添加结果 |
|bl.coupon.CouponService.addVIPCoupon| **语法:** CouponVO addVIPCoupon(VIPCouponVO couponVO)) |
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加会员生日优惠策略，返回添加结果 |
| bl.coupon.CouponService.deleteCoupon | **语法:** ResponseVO deleteCoupon(Integer couponId) |
| | **前置条件:** 删除优惠 |
| | **后置条件:** 返回删除结果 |
|bl.coupon.CouponMatchStrategy.isMatch| **语法:** boolean isMatch(OrderVO orderVO, Coupon coupon) |
|        | **前置条件:** 无 |
|        | **后置条件:** 返回订单与优惠策略是否适配的结果 |

​                                                                                               表12	blImpl.coupon模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.hotel.HotelService.retrieveHotelDetails(Integer hotelId) | 获取指定酒店的详细信息 |
| data.coupon.CouponMapper.insertCoupon(Coupon coupon) | 插入单一持久化对象 |
| data.coupon.CouponMapper.selectByHotelId(Integer hotelId) | 根据ID进行查找多个持久化对象 |
| data.vip.VIPMapper.getVIPById(int userId) | 根据userId进行查找单一持久化对象 |

​                                                                                               表13	blImpl.coupon需要的服务

##### 5.3.2.3 blImpl.hotel模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.hotel.HotelService.addHotel| **语法:** Integer addHotel(HotelVO hotelVO,int adminId) throws ServiceException|
|        | **前置条件:** hotelVO中信息格式均无误且由管理人员操作 |
|        | **后置条件:** 以hotelVO中信息添加酒店 |
|bl.hotel.HotelService.removeHotel| **语法:** int removeHotel(Integer hotelId) |
|        | **前置条件:** 由管理人员操作，酒店存在 |
|        | **后置条件:** 删除指定酒店 |
|bl.hotel.HotelService.addHotelManager| **语法:** ResponseVO addHotelManager(Integer hotelId, Integer managerId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 修改指定酒店的工作人员Id |
|bl.hotel.HotelService.updateHotelDetail| **语法:** ResponseVO updateHotelDetail(HotelDetail hotelDetail,int hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 修改指定酒店的信息 |
|bl.hotel.HotelService.updateRoomInfo| **语法:** void updateRoomInfo(Integer hotelId, String roomType,Integer roomNum) throws ServiceException |
|        | **前置条件:** 线上预订成功或线下入住或线下退房 |
|        | **后置条件:** 查找指定酒店中指定类型的客房，修改其剩余客房信息 |
|bl.hotel.HotelService.retrieveHotels| **语法:** List&lt;HotelVO&gt; retrieveHotels() |
|        | **前置条件:** 无 |
|        | **后置条件:** 列表获取酒店信息 |
|bl.hotel.HotelService.retrieveHotelDetails| **语法:** HotelVO retrieveHotelDetails(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店，返回其详细信息 |
|bl.hotel.HotelService.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId,String roomType) throws ServiceException|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店的指定类型房间，返回其剩余数量 |
|bl.hotel.HotelService.insertRoomInfo| **语法:** ResponseVO insertRoomInfo(HotelRoom hotelRoom) |
|        | **前置条件:** 无 |
|        | **后置条件:** 添加指定的酒店客房信息 |
|bl.hotel.RoomService.retrieveHotelRoomInfo| **语法:** List&lt;HotelRoom&gt; retrieveHotelRoomInfo(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店，返回其全部房间信息 |
|bl.hotel.RoomService.insertRoomInfo| **语法:** void insertRoomInfo(HotelRoom hotelRoom) |
|        | **前置条件:** 无 |
|        | **后置条件:** 添加指定的酒店客房信息 |
|bl.hotel.RoomService.updateRoomInfo| **语法:** void updateRoomInfo(Integer hotelId, String roomType, Integer rooms) throws ServiceException|
|        | **前置条件:** 线上预订成功或线下入住或线下退房 |
|        | **后置条件:** 查找指定酒店的指定类型客房，更新其数量 |
| bl.hotel.RoomService.updateRoomBase | **语法: **public void updateRoomBase(HotelRoom hotelRoom) throws ServiceException |
| | **前置条件:** |
| | **后置条件:** |
|bl.hotel.RoomService.deleteRoomInfo| **语法:** void deleteRoomInfo(Integer hotelId, String roomType) throws ServiceException|
|        | **前置条件:** 无 |
|        | **后置条件:** 删除指定酒店的指定类型客房 |
|bl.hotel.RoomService.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId, String roomType) throws ServiceException |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店的指定类型房间，返回其剩余数量 |

​                                                                                               表14	blImpl.hotel模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| data.hotel.HotelMapper.insertHotel(Hotel hotel) | 插入单一持久化对象 |
| data.hotel.HotelMapper.deletehotel(int hotelId) | 删除根据id查找到的单一持久化对象 |
| data.hotel.HotelMapper.updateHotelManager(Integer hotelId, Integer managerId) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.hotel.HotelMapper.updateHotelDetail(Integer hotelId, String address, String bizRegion, String hotelStar, String hotelService, String description, String phoneNum) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.hotel.HotelMapper.selectAllHotel() | 查找多个持久化对象 |
| data.hotel.HotelMapper.selectById(Integer id) | 根据ID进行查找单一持久化对象 |
| data.hotel.RoomMapper.selectRoomsByHotelId(Integer hotelId) | 根据ID进行查找多个持久化对象 |
| data.hotel.RoomMapper.insertRoom(HotelRoom hotelRoom) | 插入单一持久化对象 |
| data.hotel.RoomMapper.updateRoomInfo(Integer hotelId, RoomType roomType, Integer curNum) | 根据curNum改变根据hotelID与roomType查找到的单一持久化对象的属性 |
| data.hotel.RoomMapper.getRoomCurNum(Integer hotelId, RoomType roomType) | 得到根据hotelId与roomType查找到的单一持久化对象的属性 |
| data.hotel.RoomMapper.deleteRoom(Integer hotelId, RoomType roomType) | 删除单一持久化对象 |

​                                                                                               表15	blImpl.hotel需要的服务

##### 5.3.2.4 blImpl.marketer模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.marketer.MarketerService.getAbnormalOrders| **语法:** List&lt;Order&gt; getAbnormalOrders() |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找所有异常订单 |
|bl.marketer.MarketerService.annulAbnormalOrder| **语法:** ResponseVO annulAbnormalOrder(int orderid, double percent) |
|        | **前置条件:** 订单异常 |
|        | **后置条件:** 撤销订单，并为用户恢复订单总价值乘以percent的信用值，恢复房间，返回撤销成功与否的结果 |
|bl.marketer.MarketerService.buyCredit| **语法:** ResponseVO buyCredit(String email, double credit) |
|        | **前置条件:** 输入的账号存在 |
|        | **后置条件:** 根据账号查找用户并增加其信用值，返回更新成功与否的结果 |

​                                                                                               表16	blImpl.marketer模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.order.OrderService.annulOrder(int orderid) | 撤销订单以及恢复房间 |
| bl.vip.VIPService.updateClientCredit(int userId, double credit) | 增减用户信用值 |
| data.order.OrderMapper.getOrderById(int orderid) | 根据ID进行查找单一持久化对象 |
| data.user.AccountMapper.getAccountByName(String email) | 根据email查找单一持久化对象 |
| data.marketer.MarketerMapper.getAllAbnormalOrders() | 查找多个持久化对象 |

​                                                                                               表17	blImpl.marketer需要的服务

##### 5.3.2.5 blImpl.order模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.order.OrderService.addOrder| **语法:** ResponseVO addOrder(OrderVO orderVO)|
|        | **前置条件:** 订单信息填写完整 |
|        | **后置条件:** 添加订单并更新酒店剩余房间信息，并开始异常订单的计时，返回预订成功与否的结果 |
|bl.order.OrderService.getAllOrders| **语法:** List&lt;Order&gt; getAllOrders() |
|        | **前置条件:** 无 |
|        | **后置条件:** 获得所有订单信息 |
|bl.order.OrderService.getUserOrders| **语法:** List&lt;Order&gt; getUserOrders(int userid) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找用户，返回其所有订单信息 |
|bl.order.OrderService.annulBookedOrder| **语法:** ResponseVO annulBookedOrder(int orderid) |
|        | **前置条件:** 客户在最晚执行时间前撤销未执行订单 |
|        | **后置条件:** 撤销订单并更新酒店剩余房间等信息，按条件更新用户信用，返回撤销成功与否的结果 |
|bl.order.OrderService.annulOrder| **语法:** void annulOrder(int orderid)  throws ServiceException|
|        | **前置条件:** 无 |
|        | **后置条件:** 撤销订单并更新酒店剩余房间等信息 |
|bl.order.OrderService.abnormalOrder| **语法:** void abnormalOrder(int orderid) throws ServiceException|
|        | **前置条件:** 订单预订成功后在超过最晚订单执行时间后还没有执行 |
|        | **后置条件:** 将订单状态置为“异常”，并为用户扣除等于订单总价值的信用值 |
|bl.order.OrderService.solveAbnormalOrder| **语法:** ResponseVO solveAbnormalOrder(int orderid) |
|        | **前置条件:** 异常订单在离店时间时仍未被置为已执行或已撤销 |
|        | **后置条件:** 将订单状态置为“过期异常”，并恢复房间 |
|bl.order.OrderService.excuteOrder| **语法:** ResponseVO excuteOrder(int orderid) |
|        | **前置条件:** 酒店工作人员要为入住客户执行“未执行”或“异常”的订单 |
|        | **后置条件:** 执行订单，并为用户加上等同于订单总价值的信用值，返回执行成功与否的结果 |
|bl.order.OrderService.leaveEarly| **语法:** ResponseVO leaveEarly(int orderid) |
|        | **前置条件:** 当前日期早于订单结束日期 |
|        | **后置条件:** 修改订单的结束日期为当前日期，重新计算并更改价格，返回执行成功与否的结果 |
|bl.order.OrderService.getHotelOrders| **语法:** List&lt;Order&gt; getHotelOrders(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店，返回其所有订单 |

​                                                                                               表18	blImpl.order模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.hotel.HotelService.getRoomCurNum(Integer hotelId,String roomType) | 查看指定酒店的指定房间的剩余数量 |
| bl.hotel.HotelService.updateRoomInfo(Integer hotelId, String roomType,Integer rooms) | 修改指定酒店的指定类型客房的剩余数量 |
| bl.user.AccountService.getUserInfo(int id) | 获取用户个人信息 |
| bl.vip.VIPService.updateClientCredit(int userId, double credit) | 增减用户信用值 |
| data.order.OrderMapper.addOrder(Order order) | 插入单一持久化对象 |
| data.order.OrderMapper.updateOrder(Integer orderId, String checkOutDate, Double price) | 改变根据order中的ID查找到的单一持久化对象的属性 |
| data.order.OrderMapper.getAllOrders() | 查找多个持久化对象 |
| data.order.OrderMapper.getUserOrders(int userid) | 根据ID进行查找多个持久化对象 |
| data.order.OrderMapper.getOrderById(int orderid) | 根据ID进行查找单一持久化对象 |
| data.order.OrderMapper.annulOrder(int orderid) | 改变根据ID查找到的单一持久化对象的属性 |
| data.order.OrderMapper.excuteOrder(int orderid) | 改变根据ID查找到的单一持久化对象的属性 |
| data.order.OrderMapper.abnormalOrder(int orderid) | 改变根据ID查找到的单一持久化对象的属性 |
| data.order.OrderMapper.solveAbnormalOrder(int orderid) | 改变根据ID查找到的单一持久化对象的属性 |

​                                                                                               表19	blImpl.order需要的服务

##### 5.3.2.6 blImpl.rar模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.rar.RARService.rateAndReview| **语法:** ResponseVO rateAndReview(Integer orderId, double rate, String review) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为每个订单添加评论 |
|bl.rar.RARService.calHotelRate| **语法:** void calHotelRate(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为指定酒店更新评分 |
|bl.rar.RARService.getHotelRAR| **语法:** List&lt;Judgment&gt; getHotelRAR(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为指定酒店获取评价列表 |

​                                                                                               表20	blImpl.rar模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| data.order.OrderMapper.getOrderById(int orderid) | 根据ID进行查找单一持久化对象 |
| data.rar.RARMapper.insertRAR(Judgment judgment) | 插入单一持久化对象 |
| data.rar.RARMapper.updateHotelRate(Integer hotelId, Double rate) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.rar.RARMapper.selectRARByHotelId(Integer hotelId) | 根据hotelID进行查找多个持久化对象 |

​                                                                                               表21	blImpl.rar需要的服务

##### 5.3.2.7 blImpl.user模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.user.AccountService.registerAccount| **语法:** ResponseVO registerAccount(UserVO userVO)|
|        | **前置条件:** UserVO中信息均符合格式 |
|        | **后置条件:** 以UserVO中信息注册账号，返回注册成功与否的结果 |
|bl.user.AccountService.login| **语法:** User login(UserForm userForm) |
|        | **前置条件:** userForm中信息均符合格式 |
|        | **后置条件:** 根据userForm查找用户并验证，登录成功会将用户信息保存在session中，返回登陆验证的结果 |
|bl.user.AccountService.getUserInfo| **语法:** User getUserInfo(int id) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找用户，返回其个人信息 |
|bl.user.AccountService.updateUserInfo| **语法:** ResponseVO updateUserInfo(int id, String password,String username,String phonenumber) |
|        | **前置条件:** 输入信息均符合格式 |
|        | **后置条件:** 根据输入查找用户并更新其个人信息，返回更新成功与否的结果 |
|bl.user.AccountService.updateUserCredit| **语法:** void updateUserCredit(int id, double credit) |
|        | **前置条件:** 输入信息均符合格式 |
|        | **后置条件:** 根据输入查找用户并更新其信用值，返回更新成功与否的结果 |

​                                                                                               表22	blImpl.user模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| data.user.AccountMapper.createNewAccount(User user) | 插入单一持久化对象 |
| data.user.AccountMapper.getAccountByName(String email) | 根据email查找单一持久化对象 |
| data.user.AccountMapper.getAccountById(int id) | 根据ID进行查找单一持久化对象 |
| data.user.AccountMapper.updateAccount(int id, String password, String username, String phonenumber) | 改变根据ID查找到的单一持久化对象的属性 |
| data.user.AccountMapper.updateAccountCredit(int id, double credit) | 改变根据ID查找到的单一持久化对象的属性 |

​                                                                                               表23	blImpl.user需要的服务

##### 5.3.2.8 blImpl.vip模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|bl.vip.VIPService.registerVIP| **语法:** ResponseVO registerVIP(VIPVO vipVO)|
|        | **前置条件:** VIPUserVO中信息均符合格式 |
|        | **后置条件:** 以VIPUserVO中信息注册会员，返回注册成功与否的结果 |
|bl.vip.VIPService.getVIPInfo| **语法:** VIP getVIPInfo(int userId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 以userId查找会员，返回会员信息 |
|bl.vip.VIPService.updateClientCredit| **语法:** void updateClientCredit(int userId, double credit) throws ServiceException |
|        | **前置条件:** 无 |
|        | **后置条件:** 根据输入查找用户并更新其信用值 |
|bl.vip.VIPService.updateVIPLevel| **语法:** void updateVIPLevel(int userId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 根据会员用户当前信用值更新其会员等级 |
|bl.vip.VIPService.setVIPLevel| **语法:** void setVIPLevel(int vipId, VIPLevel level) |
|        | **前置条件:** 无 |
|        | **后置条件:** 设置会员用户的等级 |

​                                                                                               表24	blImpl.vip模块的接口规范

###### 需要的服务（需接口）

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.user.AccountService.getUserInfo(int id) | 根据ID查找用户信息 |
| bl.user.AccountService.updateUserCredit(int id, double credit) | 根据ID与credit更新用户的信用值 |
| data.vip.VIPMapper.createNewVIP(VIP vip) | 插入单一持久化对象 |
| data.vip.VIPMapper.getVIPByUserId(int userId) | 根据userId进行查找单一持久化对象 |
| data.vip.VIPMapper.setVIPLevel(int vipId, VIPLevel level) | 改变根据ID查找到的单一持久化对象的属性 |

​                                                                                               表25	blImpl.vip需要的服务

### 5.4 数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。数据层模块的描述具体如下图所示。
![数据层](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E6%95%B0%E6%8D%AE%E5%B1%82%E7%9A%84%E8%AE%BE%E8%AE%A1.png)

#### 5.4.1 职责

|         模块         | 职责                   |
| :--------------------: | ---------------------- |
| data.admin | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.coupon | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.hotel | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.marketer | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.order | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.rar | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.user | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| data.vip | 持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.admin | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.coupon | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.hotel | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.marketer | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.order | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.rar | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.user | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| dataImpl.vip | 基于MySql数据库的持续化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

​                                                                                               表26	数据层各模块职责

#### 5.4.2 接口规范

##### 5.4.2.1 data.admin模块的接口规范
###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.admin.AdminMapper.addManager| **语法:** int addManager(User user)|
|        | **前置条件:** 同样ID的user在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个user记录并返回id属性 |
|data.admin.AdminMapper.addMarketer| **语法:** int addMarketer(User user)|
|        | **前置条件:** 同样ID的user在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个user记录 |
|data.admin.AdminMapper.getAllManagers| **语法:** List&lt;User&gt; getAllManagers()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |
|data.admin.AdminMapper.getAllMarketers| **语法:** List&lt;User&gt; getAllMarketers()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |
|data.admin.AdminMapper.getAllClients| **语法:** List&lt;User&gt; getAllClients()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |

​                                                                                               表27	data.admin模块的接口规范

##### 5.4.2.2 data.coupon模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.coupon.CouponMapper.insertCoupon| **语法:** int insertCoupon(Coupon coupon)|
|        | **前置条件:** 同样ID的coupon在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个coupon记录 |
|data.coupon.CouponMapper.selectByHotelId| **语法:** List&lt;Coupon&gt; selectByHotelId(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelID进行查找返回相应的List&lt;Coupon&gt;结果 |
| data.coupon.CouponMapper.deleteCoupon | **语法:**int deleteCoupon(Integer id); |
| | **前置条件:** 在数据库中存在同样id的Coupon记录 |
| | **后置条件:** 删除同样id的Coupon记录 |

​                                                                                               表28	data.coupon模块的接口规范

##### 5.4.2.3 data.hotel模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.hotel.HotelMapper.insertHotel| **语法:** int insertHotel(Hotel hotel)|
|        | **前置条件:** 同样ID的hotel在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个hotel记录 |
|data.hotel.HotelMapper.updateHotelManager| **语法:** int updateHotelManager(Integer hotelId, Integer managerId)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的manageId属性 |
|data.hotel.HotelMapper.updateHotelDetail| **语法:** int updateHotelDetail(Integer hotelId, String address, String bizRegion, String hotelStar, String hotelServiice, String description, String phoneNum)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的address、bizRegion、hotelStar、hotelService、description、phoneNum属性 |
|data.hotel.HotelMapper.selectAllHotel| **语法:** List&lt;HotelVO&gt; selectAllHotel()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;HotelVO&gt;结果 |
|data.hotel.HotelMapper.selectById| **语法:** HotelVO selectById(Integer id)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按id进行查找返回相应的HotelVO结果 |
|data.hotel.HotelMapper.deleteHotel| **语法:** int deleteHotel(Integer hotelId)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 在数据库中删除一个hotel记录 |
|data.hotel.RoomMapper.updateRoomInfo| **语法:** int updateRoomInfo(Integer hotelId, RoomType roomType, Integer curNum) |
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 更新该HotelRoom记录的curNum属性 |
| data.hotel.RoomMapper.updateRoomBase | **语法:** int updateRoomBase(HotelRoom hotelRoom)            |
|                                            | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
| | **后置条件:** 更新该HotelRoom记录的所有属性 |
|data.hotel.RoomMapper.insertRoom| **语法:** int insertRoom(HotelRoom hotelRoom)|
|        | **前置条件:** 同样hotelId与roomType的HotelRoom记录在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个hotelRoom记录 |
|data.hotel.RoomMapper.deleteRoom| **语法:** int deleteRoom(Integer hotelId, RoomType roomType)|
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 在数据库中删除一个hotelRoom记录 |
|data.hotel.RoomMapper.selectRoomsByHotelId| **语法:** List&lt;HotelRoom&gt; selectRoomsByHotelId(Integer hotelId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelId进行查找返回相应的List&lt;HotelRoom&gt;结果 |
|data.hotel.RoomMapper.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId, RoomType roomType) |
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 返回该HotelRoom记录的curNum属性 |

​                                                                                               表29	data.hotel模块的接口规范

##### 5.4.2.4 data.marketer模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.marketer.MarketerMapper.getAllAbnormalOrders| **语法:** List&lt;Order&gt; getAllAbnormalOrders()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;Order&gt;结果 |

​                                                                                               表30	data.marketer模块的接口规范

##### 5.4.2.5 data.order模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.order.OrderMapper.addOrder| **语法:** int addOrder(Order order)|
|        | **前置条件:** 同样ID的order在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个order记录 |
|data.order.OrderMapper.updateOrder| **语法:** int updateOrder(Integer orderId, String checkOutDate, Double price)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的checkOutDate、price属性 |
|data.order.OrderMapper.getAllOrders| **语法:** List&lt;Order&gt; getAllOrders()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;Order&gt;结果 |
|data.order.OrderMapper.getUserOrders| **语法:** List&lt;Order&gt; selectById(Integer userId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按userId进行查找返回相应的List&lt;Order&gt;结果 |
|data.order.OrderMapper.getOrderById| **语法:** Order getOrderById(int orderid)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按orderid进行查找返回相应的Order结果 |
|data.order.OrderMapper.annulOrder| **语法:** int annulOrder(int orderid)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的orderState属性为“已撤销” |
|data.order.OrderMapper.excuteOrder| **语法:** int excuteOrder(int orderid)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的orderState属性为“已执行” |
|data.order.OrderMapper.abnormalOrder| **语法:** int abnormalOrder(int orderid)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的orderState属性为“异常” |
|data.order.OrderMapper.solveAbnormalOrder| **语法:** int solveAbnormalOrder(int orderid)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的orderState属性为“过期异常” |
| data.order.OrderMapper.orderRAR | **语法**：int orderRAR(int orderid) |
| | **前置条件**：在数据库中存在同样orderid的Order记录 |
| | **后置条件**：更新该Order记录的rar属性为“true” |

​                                                                                               表31	data.order模块的接口规范

##### 5.4.2.6 data.rar模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.rar.RARMapper.insertRAR| **语法:** int insertRAR(Judgment judgment)|
|        | **前置条件:** 同样orderId的Judgment记录在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个Judgment记录 |
|data.rar.RARMapper.updateHotelRate| **语法:** int updateHotelRate(Integer hotelId, Double rate)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的rate属性 |
|data.rar.RARMapper.selectRARByHotelId| **语法:** List&lt;Judgment&gt; selectRARByHotelId(Integer hotelId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelId进行查找返回相应的List&lt;Judgment&gt;结果 |

​                                                                                               表32	data.rar模块的接口规范

##### 5.4.2.7 data.user模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.user.AccountMapper.createNewAccount| **语法:** int createNewAccount(User user)|
|        | **前置条件:** 同样ID的user在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个user记录 |
|data.user.AccountMapper.getAccountByName| **语法:** User getAccountByName(String email)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按email进行查找返回相应的User结果 |
|data.user.AccountMapper.getAccountById| **语法:** User getAccountById(int id)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按id进行查找返回相应的User结果 |
|data.user.AccountMapper.deleteAccountById| **语法:** int deleteAccountById(int id)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 在数据库中删除一个User记录 |
|data.user.AccountMapper.updateAccount| **语法:** int updateAccount(int id, String password, String username, String phonenumber)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 更新该User记录的password、username、phonenumber属性 |
|data.user.AccountMapper.updateAccountCredit| **语法:** int updateAccountCredit(int id, double credit)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 更新该User记录的credit属性 |

​                                                                                               表33	data.user模块的接口规范

##### 5.4.2.8 data.vip模块的接口规范

###### 提供的服务（供接口）
| 接口名 |         |
| ------ | :----------- |
|data.vip.VIPMapper.createNewVIP| **语法:** int createNewVIP(VIP vip)|
|        | **前置条件:** 同样ID的vip在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个vip记录 |
|data.vip.VIPMapper.getVIPByUserId| **语法:** VIP getVIPByUserId(int userId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按userId进行查找返回相应的VIP结果 |
|data.vip.VIPMapper.setVIPLevel| **语法:** int setVIPLevel(int vipId, VIPLevel level)|
|        | **前置条件:** 在数据库中存在同样id的VIP记录 |
|        | **后置条件:** 更新该User记录的level属性 |

​                                                                                               表34	data.vip模块的接口规范

## 6. 信息视角

### 6.1 数据持久化对象
- CouponPO类是包含优惠券相关属性的实体类，包含优惠券的id、描述、类型、名称、使用门槛、优惠金额、状态，酒店id，折扣，可用时间，失效时间的属性
- HotelPO类包含酒店id、名字、地址、商圈、星级、介绍、电话号码，酒店管理员id属性
- HotelRoomPO类包含房间id、类型，酒店id，价格，剩余可预定房间数，某类型房间总数的属性
- orderPO类包含订单号、用户、酒店的id，酒店名字，入住日期，离开日期，房间类型，房间号码，判断是否有孩子，价格，创建日期，创建名字，电话号码，订单状态的属性
- UserPO类包含用户的id，邮箱，用户名，密码，电话号码，信用卡，用户类型的属性
- JudgementPO类包含评论号、订单号、用户id、酒店id、所属酒店、评价时间、评分、评论内容
- VIPPO类包含会员号、用户id、用户生日、会员点数、会员等级

### 6.2 定义

```
public class Coupon {
    /**
     * 优惠券id
     */
    private int id;
    /**
     * 优惠券描述
     */
    private String description;

    /**
     * 如果为-1 代表是网站推出的优惠
     */
    private Integer hotelId;

    /**
     * 优惠券类型 1生日特惠 2多间特惠 3满减优惠 4限时优惠
     */
    private Integer couponType;
    /**
     * 优惠券名称
     */
    private String couponName;
    /**
     * 优惠券使用门槛
     */
    private double targetMoney;

    /**
     * 折扣
     */
    private double discount;
    /**
     * 优惠券优惠金额
     */
    private double discountMoney;
    /**
     * 可用时间
     */
    private LocalDateTime startTime;
    /**
     * 失效时间
     */
    private LocalDateTime endTime;
    /**
     * 房间数
     */
    private int roomNum;
    /**
     * 商圈
     */
    private BizRegion bizRegion;
    /**
     * 等级
     */
    private VIPLevel vipLevel;
    /**
     * 优惠券状态 是否已经失效 1可用 0失效
     */
    private Integer status;
}
```
                                     持久化用户对象CouponPO的定义


​                                     

```
public class Hotel {
    private Integer id;
    private String hotelName;
    private String address;
    private BizRegion bizRegion;
    private HotelStar hotelStar;
    private String hotelService;
    private Double rate;
    private String description;
    private String phoneNum;
    private Integer managerId;
}
```
                                      持久化用户对象HotelPO的定义



```
public class HotelRoom {
    private Integer id;
    private RoomType roomType;
    private Integer hotelId;
    private double price;
    private int curNum;
    private int total;//某类型房间总数
}

```
                                     持久化对象对HotelRoomPO的定义


```
public class Judgment {
    private Integer id;
    private Integer orderId;
    private Integer userId;
    private Integer hotelId;
    private String createDate;//最好包括时分秒
    private Double rate;
    private String comment;
}

```
							持久化对象对JudgementPO的定义


```
public class Order {
    private Integer id;
    private Integer userId;
    private Integer hotelId;
    private String hotelName;
    private String checkInDate;
    private String checkOutDate;
    private String roomType;
    private Integer roomNum;
    private Integer peopleNum;
    private boolean haveChild;
    private String createDate;
    private Double price;
    private String clientName;
    private String clientEmail；
    private String phoneNumber;
    private String orderState;
    private boolean rar;
}
```
                                      持久化对象对OrderPO的定义



```
    public class User {
    private Integer id;
    private String email;
    private String password;
    private String userName;
    private String phoneNumber;
    private double credit;
    private UserType userType;
}

```
                                    持久化对象对UserPO的定义

```
public class VIP {
    private Integer id;
    private Integer userId;
    private LocalDateTime birthday;
    private double points;
    private VIPLevel level;
}

```
							持久化对象对VIPPO的定义
### 6.3 数据库表

- 数据库中包含User表、Coupon表、Hotel表、HotelRoom表、Order表

#### Coupon表

| 属性           | 类型         |
| -------------- | ------------ |
| id             | int(11)      |
| description    | varchar(255) |
| hotelId        | int(11)      |
| couponType     | int(11)      |
| couponName     | varchar(255) |
| target_money   | int(11)      |
| discount       | double       |
| status         | int(11)      |
| start_time     | datetime     |
| end_time       | datetime     |
| discount_money | int(11)      |
| bizRegion      | varchar(255) |
| vipLevel       | varchar(255) |
| room_num       | int=3        |

#### Hotel表

| 属性             | 类型         |
| ---------------- | ------------ |
| id               | int(11)      |
| hotelName        | varchar(255) |
| hotelDescription | varchar(255) |
| address          | varchar(255) |
| bizRegion        | varchar(255) |
| hotelStar        | varchar(255) |
| phoneNum         | int(11)      |
| rate             | double       |
| manager_id       | int(11)      |
| hotelService     | varchar(255) |



#### orderlist表

| 属性         | 类型         |
| ------------ | ------------ |
| id           | int(11)      |
| userId       | int(11)      |
| hotelId      | int(11)      |
| hotelName    | varchar(255) |
| checkInDate  | varchar(255) |
| checkOutDate | varchar(255) |
| roomType     | varchar(255) |
| roomNum      | int(255)     |
| peopleNum    | int(255)     |
| haveChild    | tinytext     |
| createDate   | varchar(255) |
| price        | decimal(65)  |
| clientName   | varchar(255) |
| phoneNumber  | varchar(255) |
| phoneNumber  | varchar(255) |
| orderState   | varchar(255) |
| rar          | tinytext     |

#### room表

| 属性     | 类型        |
| -------- | ----------- |
| id       | int(1)      |
| price    | double      |
| curNum   | int(11)     |
| total    | int(11)     |
| hotel_id | int(11)     |
| roomType | varchar(50) |

#### User表

| 属性        | 类型         |
| ----------- | ------------ |
| id          | int(11)      |
| email       | varchar(255) |
| password    | varchar(11)  |
| username    | varchar(255) |
| phonenumber | varchar(255) |
| credit      | double(255)  |
| usertype    | varchar(255) |



####  Judgement表

| 属性    | 类型         |
| ----------- | ------------ |
| id      | int(11)      |
| orderId | int(11) |
| userId | int(11)      |
| comment | varchar(255) |
| hotelId | int(11) |
| createDate | varchar(255) |
| rate | double |



####  VIP表

| 属性     | 类型         |
| -------- | ------------ |
| id       | int(11)      |
| userId   | int(11)      |
| birthday | datetime     |
| points   | double(255)  |
| vipLevel | varchar(255) |