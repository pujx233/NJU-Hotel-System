# 互联网酒店预订系统软件详细设计描述文档

## 目录
1. **引言**
    1.1 编制目的
    1.2 词汇表
    1.3 参考资料
    
2. **产品概述**

3. **体系结构设计概述**

4. **结构视角**
    4.1 展示层的分解
        4.1.1 views.admin模块
    
    ​    4.1.2 views.hotel模块
    
    ​    4.1.3  views.order模块
    
    ​    4.1.4 views.user模块
    
    ​    4.1.5 views.marketer模块
    
    4.2 业务逻辑层的分解
    
    ​    4.2.1 blImpl.admin模块
    
    ​    4.2.2 blImpl.coupon模块
    
    ​    4.2.3 blImpl.hotel模块
    
    ​    4.2.4 blImpl.order模块
    
    ​    4.2.5 blImpl.user模块
    
    ​    4.2.6 blImpl.VIP模块
    
    ​    4.2.7 blImpl.marketer模块
    
    ​    4.2.8 blImpl.rar模块
    
    4.3 数据层的分解
    
    ​    4.3.1 data.admin模块
    
    ​    4.3.2 data.coupon
    
    ​    4.3.3 data.hotel
    
    ​    4.3.4 data.order模块
    
    ​    4.3.5 data.user模块
    
    ​    4.3.6 data.VIP模块
    
    ​    4.3.7 data.marketer模块
    
    ​    4.3.8 data.rar模块
    
5. **依赖视角**

6. **变更记录**

## 1. 引言

### 1.1 编制目的

本文档完成对互联网酒店预订系统的详细设计，用以指导后续软件开发，同时实现和测试人员和用户的沟通。

### 1.2 词汇表

| 词汇名称 | 词汇含义 | 备注 |
| :------: | -------- | ---- |
|          |          |      |

### 1.3 参考资料
1）互联网酒店预订系统软件体系结构文档
2）互联网酒店预订系统需求用例文档
3）互联网酒店预订系统需求规格文档

## 2. 产品概述
参考互联网酒店预订系统需求用例文档和互联网酒店预订系统需求规格文档中对产品的概括描述。

## 3. 体系结构设计概述
参考互联网酒店预订系统软件体系结构文档中对体系结构设计的概述。

## 4. 结构视角
### 4.1 展示层的分解
#### 4.1.1 views.admin模块
（1）模块概述

views.admin模块承担的需求参见需求规格文档功能需求和相关非功能需求。

views.admin模块的职责及接口参见软件体系结构文档表5,6,7。

（2）整体结构

根据体系结构的设计，我们将系统分为展示层，业务逻辑层和数据层。为了提高每一层的灵活性，我们在相邻两层之间添加了接口。对于views.admin，其通过接口api.admin与服务器端进行数据交流。manageUser.vue是网站管理人员查看用户基本信息页面，从该页面可以进入添加酒店管理人员页面（addManagerModal.vue）。

![views.admin模块的构件设计](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/views.admin%E6%A8%A1%E5%9D%97%E7%9A%84%E6%9E%84%E4%BB%B6%E8%AE%BE%E8%AE%A1%28%E6%96%B0%29.png)

​                                                               图	views.admin模块的构件设计

​                                                               表	views.admin模块的构件的职责

|         构件         |                      职责                      |
| :------------------: | :--------------------------------------------: |
|    manageUser.vue    | 负责展示网站管理人员的主页面，可以展示用户信息 |
| addManagerModal.vue  |      负责网站管理人员添加新的酒店管理人员      |
|  addHotelModal.vue   |             负责添加酒店的信息填写             |
|    amendUser.vue     |             负责修改各类用户的信息             |
| addMarketerModal.vue |              负责添加网站营销人员              |
|     addHotel.vue     | 负责展示酒店列表，提供添加酒店和删除酒店的入口 |

（3）模块内部类的接口规范

提供的服务（供接口）由vue框架提供，无需自行定义。

需要的服务（需接口）如下表：

​                                                               表	views.admin模块需要的服务

| 服务名                            | 服务                                     |
| --------------------------------- | ---------------------------------------- |
| api.admin.js.getManagerListAPI()  | 从服务器获得所有酒店管理人员的列表       |
| api.admin.js.addManagerAPI(data)  | 将新增加的酒店管理人员信息发送给服务器   |
| api.admin.js.getClientListAPI()   | 从服务器获得所有客户列表                 |
| api.admin.js.getMarketerListAPI() | 从服务器获得所有网站营销人员列表         |
| api.admin.js.renewAPI(data)       | 将修改的用户信息发送给服务器             |
| api.admin.js.addHotelAPI(data)    | 将增加新的酒店的信息发送给服务器         |
| api.admin.js.addMarketerAPI(data) | 将增加新的网站营销人员的信息发送给服务器 |
| api.admin.deleteHotelAPI(data)    | 删除酒店                                 |
| api.admin.updateUserInfoAPI(data) | 将更新的用户信息发送给服务端             |
| api.admin.removeUserAPI(userId)   | 删除某个账号                             |

（4）展示层的动态模型
![views.admin模块的页面跳转状态图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/views.admin%E7%9A%84%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E7%8A%B6%E6%80%81%E5%9B%BE.png)
​                                                               图	views.admin模块的页面跳转状态图

（5）展示层的设计原理
采用Vue框架，实现页面数据的集中管理和界面的构件化。

#### 4.1.2 views.hotel模块

（1）模块概述

views.hotel模块承担的需求参见需求规格文档功能需求和相关非功能需求。

views.hotel模块的职责及接口参见软件体系结构文档表。

（2）整体结构

根据需求，存在两个页面，酒店列表页和酒店详细信息页。其中页面跳转是

![页面跳转](https://njuse.oss-cn-shenzhen.aliyuncs.com/view.hotel1.jpg)

可以分解为hotelList、hotelDetail、hotelCard、ordermodal、roomList

（3）模块内部类的接口规范

提供的服务

| 接口名  |          语法          |
| :-----: | :--------------------: |
| APP.vue |    **前置条件**：无    |
|         | **后置条件**：显示界面 |

需要的服务

|    服务名     | 服务                                   |
| :-----------: | -------------------------------------- |
| api.hotel.js  | 酒店界面向后端发起数据请求的服务接口   |
| api.coupin.js | 优惠券界面向后端发起数据请求的服务接口 |
| api.order.js  | 订单界面向后端发起数据请求的服务接口   |

|            服务名             | 服务                       |
| :---------------------------: | -------------------------- |
|     bl.hotel.HotelService     | 酒店界面的业务逻辑接口     |
|     bl.hotel.RoomService      | 酒店房间界面的业务逻辑接口 |
|     bl.order.OrderService     | 订单界面的业务逻辑接口     |
| bl.coupon.CouponMatchStrategy | 优惠券匹配的业务逻辑接口   |
|    bl.coupon.CouponService    | 优惠券界面的业务逻辑接口   |

（4）展示层的设计原理

根据单一职责原则， 将每个页面的职责从类中分离。利用集中式控制的原理，进行页面的跳转。

#### 4.1.3 views.order模块

（1）模块概述

views.order模块承担的需求参见需求规格文档功能需求和相关非功能需求。

views.order模块的职责及接口参见软件体系结构文档表。

（2）整体结构

根据需求，存在三个页面，订单列表页、订单填写页和订单详细信息页。其中页面跳转是

<img src="https://i.loli.net/2020/06/17/TaMpfhFzjBRNkWY.png" alt="订单页面关系图.png" style="zoom:67%;" />

（3）模块内部类的接口规范

提供的服务

| 接口名  |          语法          |
| :-----: | :--------------------: |
| APP.vue |    **前置条件**：无    |
|         | **后置条件**：显示界面 |

需要的服务

|    服务名    | 服务                                 |
| :----------: | ------------------------------------ |
| api.user.js  | 客户界面向后端发起数据请求的服务接口 |
|  api.VIP.js  | VIP界面向后端发起数据请求的服务接口  |
| api.hotel.js | 酒店界面向后端发起数据请求的服务接口 |

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
|   bl.vip.VIPService    | VIP的业务逻辑接口      |
| bl.user.AccountService | 客户界面的业务逻辑接口 |
| bl.hotel.HotelService  | 酒店界面的业务逻辑接口 |

（4）展示层的设计原理

根据单一职责原则， 将每个页面的职责从类中分离。利用集中式控制的原理，进行页面的跳转。

#### 4.1.4 views.user模块

（1）模块概述

views.user模块承担的需求参见需求规格文档功能需求和相关非功能需求。

views.user模块的职责及接口参见软件体系结构文档表。

（2）整体结构

根据需求，存在一个页面，用户信息页。

（3）模块内部类的接口规范

提供的服务

| 接口名  |          语法          |
| :-----: | :--------------------: |
| APP.vue |    **前置条件**：无    |
|         | **后置条件**：显示界面 |

需要的服务

|    服务名    | 服务                                 |
| :----------: | ------------------------------------ |
| api.user.js  | 客户界面向后端发起数据请求的服务接口 |
|  api.VIP.js  | VIP界面向后端发起数据请求的服务接口  |
| api.order.js | 订单界面向后端发起数据请求的服务接口 |

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
|   bl.vip.VIPService    | VIP的业务逻辑接口      |
| bl.user.AccountService | 客户界面的业务逻辑接口 |
| bl.order.OrderService  | 订单界面的业务逻辑接口 |

（4）展示层的设计原理

根据单一职责原则， 将每个页面的职责从类中分离。利用集中式控制的原理，进行页面的跳转。

#### 4.1.5 views.marketer模块

（1）模块概述

views.marketer模块承担的需求参见需求规格文档功能需求和相关非功能需求。

views.marketer模块的职责及接口参见软件体系结构文档表。

（2）整体结构

根据需求，存在四个页面，网站营销人员主界面、制定网站促销策略界面、异常订单界面、信用充值界面。其中页面跳转是

![页面跳转](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/marketer%E7%95%8C%E9%9D%A2%E8%B7%B3%E8%BD%AC.png)

（3）模块内部类的接口规范

提供的服务

| 接口名  |          语法          |
| :-----: | :--------------------: |
| APP.vue |    **前置条件**：无    |
|         | **后置条件**：显示界面 |

需要的服务

|    服务名     | 服务                                   |
| :-----------: | -------------------------------------- |
| api.marketer.js  | 酒店营销人员相关界面向后端发起数据请求的服务接口   |

|            服务名             | 服务                       |
| :---------------------------: | -------------------------- |
|     bl.marketer.MarketerService     | 酒店界面的业务逻辑接口     |

（4）展示层的设计原理

根据单一职责原则， 将每个页面的职责从类中分离。利用集中式控制的原理，进行页面的跳转。

### 4.2 业务逻辑层的分解
#### 4.2.1 blImpl.admin模块

（1）模块概述

blImpl.admin模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.admin模块的职责及接口参见软件体系结构文档表10,11。

（2）整体结构

根据体系结构的设计，我们将系统分为展示层，业务逻辑层和数据层。为了提高每一层的灵活性，我们在相邻两层之间添加了接口。对于blImpl.admin，我们在业务逻辑层和展示层之间添加了bl.admin.AdminService接口，在业务逻辑层和数据层之间添加了data.admin.adminMapper接口。blImpl.admin内只有一个类AdminServiceImpl，是接口的实现类，提供了用户管理有关的功能。

blImpl.admin模块类的职责如下表：

|        类        |              职责              |
| :--------------: | :----------------------------: |
| AdminServiceImpl | 帮助网站管理人员进行用户管理。 |

（3）模块内部类的接口规范

| 接口名                                |                                                              |
| ------------------------------------- | :----------------------------------------------------------- |
| bl.admin.AdminService.addHotel        | **语法:** public ResponseVO addHotel(HotelVO hotelVO, int adminId) |
|                                       | **前置条件:** adminid对应的用户是网站管理人员                |
|                                       | **后置条件:** 以hotelVO中的信息添加酒店，返回新酒店ID        |
| bl.admin.AdminService.removeHotel     | **语法:**  public ResponseVO removeHotel(Integer hotelId, Integer adminId) |
|                                       | **前置条件:** adminid对应的用户是网站管理人员，且hotelId对应的酒店存在 |
|                                       | **后置条件:** 删除对应的酒店                                 |
| bl.admin.AdminService.addManager      | **语法:** public ResponseVO addManager(UserForm userForm, Integer hotelId) |
|                                       | **前置条件:** userForm中email与password符合输入规则          |
|                                       | **后置条件:** 以userForm中的信息添加酒店工作人员，返回添加结果 |
| bl.admin.AdminService.addMarketer     | **语法:** public ResponseVO addMarketer(UserForm userForm)   |
|                                       | **前置条件:** userForm中email与password符合输入规则          |
|                                       | **后置条件:** 以userForm中的信息添加网站营销人员，返回添加结果 |
| bl.admin.AdminService.getAllManagers  | **语法:** public List&lt;User&gt; getAllManagers()           |
|                                       | **前置条件:** 无                                             |
|                                       | **后置条件:** 返回所有酒店管理人员信息                       |
| bl.admin.AdminService.getAllMarketers | **语法:** public List&lt;User&gt; getAllMarketers()          |
|                                       | **前置条件:** 无                                             |
|                                       | **后置条件:** 返回所有网站营销人员信息                       |
| bl.admin.AdminService.getAllClients   | **语法:** public List&lt;User&gt; getAllClients()            |
|                                       | **前置条件:** 无                                             |
|                                       | **后置条件:** 返回所有客户信息                               |
| bl.admin.AdminService.updateUserInfo  | **语法:** ResponseVO updateUserInfo(int userId, String password, String username, String phonenumber) |
|                                       | **前置条件:** 输入信息均符合格式                             |
|                                       | **后置条件:** 根据输入查找用户并更新其信用值，返回更新成功与否的结果 |
| bl.admin.AdminService.removeUser      | **语法:** ResponseVO removeUser(int userId)                  |
|                                       | **前置条件:** 无                                             |
|                                       | **后置条件:** 删除根据输入查找到用户，返回删除成功与否的结果 |

​                                                                                               表	blImpl.admin模块的接口规范

需要的服务（需接口）：

|                            服务名                            | 服务                                   |
| :----------------------------------------------------------: | -------------------------------------- |
|       bl.hotel.HotelService.addHotel(HotelVO hotelVO)        | 添加酒店                               |
|      bl.hotel.HotelService.removeHotel(Integer hotelId)      | 根据ID删除酒店                         |
| bl.hotel.HotelService.addHotelManager(Integer hotelId, Integer managerId) | 修改指定酒店的工作人员Id               |
|            bl.hotel.HotelService.retrieveHotels()            | 获取所有酒店信息                       |
| bl.hotel.HotelService.retrieveHotelDetails(Integer hotelId)  | 根据ID查找酒店详细信息                 |
|         data.admin.AdminMapper.addManager(User user)         | 插入单一持久化对象                     |
|        data.admin.AdminMapper.addMarketer(User user)         | 插入单一持久化对象                     |
|           data.admin.AdminMapper.getAllManagers()            | 查找多个持久化对象                     |
|           data.admin.AdminMapper.getAllMarketers()           | 查找多个持久化对象                     |
|            data.admin.AdminMapper.getAllClients()            | 查找多个持久化对象                     |
|    data.user.AccountMapper.getAccountByName(String email)    | 根据email查找单一持久化对象            |
|        data.user.AccountMapper.getAccountById(int id)        | 根据ID查找单一持久化对象               |
|      data.user.AccountMapper.deleteAccountById(int id)       | 删除根据id查找到的单一持久化对象       |
| data.user.AccountMapper.updateAccount(int id, String password, String username, String phonenumber) | 改变根据ID查找到的单一持久化对象的属性 |

​                                                                                               表	blImpl.admin需要的服务

（4）业务逻辑层的动态模型

下图表明了互联网酒店预订系统中，当网站管理人员选择添加酒店工作人员时，添加酒店工作人员相关对象之间的协作。

![添加酒店工作人员的顺序图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E6%B7%BB%E5%8A%A0%E9%85%92%E5%BA%97%E5%B7%A5%E4%BD%9C%E4%BA%BA%E5%91%98%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
​                                                               图	添加酒店工作人员的顺序图

下图表明了互联网酒店预订系统中，当网站管理人员需要得到客户信息列表时时，得到客户信息列表相关对象之间的协作。

![得到客户信息列表的顺序图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E5%BE%97%E5%88%B0%E5%AE%A2%E6%88%B7%E4%BF%A1%E6%81%AF%E5%88%97%E8%A1%A8%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
                                                               图	得到客户信息列表的顺序图

（5）业务逻辑层的设计原理

bl.admin是服务器端提供的业务逻辑接口，blImpl.admin是接口的实现，blImpl通过数据层接口data.admin.AdminMapper来访问数据库，从而实现数据读取和持久化存储。

（6）重要的数据结构及算法

po.User: 持久化数据对象User，里面包含了

```java
    private Integer id;
    private String email;
    private String password;
    private String userName;
    private String phoneNumber;
    private double credit;
    private UserType userType;
```

#### 4.2.2 blImpl.coupon模块

（1）模块概述

blImpl.coupon模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.coupon模块的职责及接口参见软件体系结构文档表12,13。

（2）整体结构

根据体系结构的设计，我们将系统分为展示层，业务逻辑层和数据层。为了提高每一层的灵活性，我们在相邻两层之间添加了接口。对于blImpl.coupon，我们在业务逻辑层和展示层之间添加了bl.coupon.CouponService和bl.coupon.CouponMatchStategy接口，在业务逻辑层和数据层之间添加了data.coupon.CouponMapper接口。*PO是作为coupon的持久化对象被加入到设计模型中去的。

blImpl.coupon模块的设计如下图所示
![blImpl.coupon模块类的设计](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/blImpl.coupon%E6%A8%A1%E5%9D%97%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1.png)

​                                                               图	blImpl.coupon模块类的设计


blImpl.coupon模块类的职责如下表：

|              类               |                   职责                   |
| :---------------------------: | :--------------------------------------: |
|       CouponServiceImpl       |          负责coupon的添加、获取          |
|    RoomsCouponStrategyImpl    |     判断某个订单是否满足多间优惠策略     |
| TargetMoneyCouponStrategyImpl | 判断某个订单是否满足某种满减金额优惠策略 |
|    TimeCouponStrategyImpl     |   判断某个订单是否满足某种限时优惠策略   |
|     VIPCouponStrategyImpl     |   判断某个订单是否满足VIP生日优惠策略    |

​                                                                                               表	blImpl.coupon模块类的职责

（3）模块内部类的接口规范

提供的服务（供接口）：

| 接口名 |         |
| ------ | :----------- |
|bl.coupon.CouponService.getMatchOrderCoupon| **语法:** List&lt;Coupon&gt; getMatchOrderCoupon(OrderVO orderVO)|
|        | **前置条件:** 订单填写完整 |
|        | **后置条件:** 根据订单信息，返回该订单可用的优惠策略列表 |
|bl.coupon.CouponService.getHotelAllCoupon| **语法:** List&lt;Coupon&gt; getHotelAllCoupon(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 根据ID查找并返回某个酒店提供的所有优惠策略（包括失效的） |
|bl.coupon.CouponService.addTargetMoneyCoupon| **语法:** CouponVO addTargetMoneyCoupon(TargetMoneyCouponVO couponVO) throws ServiceException|
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加满减优惠策略，返回添加结果 |
|bl.coupon.CouponService.addTimeCoupon| **语法:** CouponVO addTimeCoupon(TimeCouponVO couponVO) throws ServiceException|
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加限时优惠策略，返回添加结果 |
|bl.coupon.CouponService.addRoomsCoupon| **语法:** CouponVO addRoomsCoupon(RoomsCouponVO couponVO) throws ServiceException|
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加多间优惠策略，返回添加结果 |
|bl.coupon.CouponService.addVIPCoupon| **语法:** CouponVO addVIPCoupon(VIPCouponVO couponVO)) throws ServiceException|
|        | **前置条件:** couponVO中的策略信息均符合规范 |
|        | **后置条件:** 添加会员优惠策略，返回添加结果 |
|bl.coupon.CouponService.deleteCoupon| **语法:** ResponseVO deleteCoupon(Integer couponId)) |
|        | **前置条件:** 无 |
|        | **后置条件:** 删除指定优惠策略，返回删除结果 |
|bl.coupon.CouponMatchStrategy.isMatch| **语法:** boolean isMatch(OrderVO orderVO, Coupon coupon) |
|        | **前置条件:** 无 |
|        | **后置条件:** 返回订单与优惠策略是否适配的结果 |

​                                                                                               表	blImpl.coupon模块的接口规范

需要的服务（需接口）：

|                          服务名                           | 服务                             |
| :-------------------------------------------------------: | -------------------------------- |
| bl.hotel.HotelService.retrieveHotelDetails(Integer hotelId) | 获取指定酒店的详细信息 |
| data.coupon.CouponMapper.insertCoupon(Coupon coupon) | 插入单一持久化对象 |
| data.coupon.CouponMapper.selectByHotelId(Integer hotelId) | 根据ID进行查找多个持久化对象 |
| data.coupon.CouponMapper.deleteCoupon(Integer id) | 根据ID删除单一持久化对象 |
| data.vip.VIPMapper.getVIPById(int userId) | 根据userId进行查找单一持久化对象 |

​                                                                                               表	blImpl.coupon需要的服务

（4）业务逻辑层的动态模型

下图表明了互联网酒店预订系统中，当客户在预订酒店需要获取订单匹配的优惠策略时，相关对象之间的协作。

![获取订单匹配的优惠策略的顺序图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E8%8E%B7%E5%8F%96%E8%AE%A2%E5%8D%95%E5%8C%B9%E9%85%8D%E7%9A%84%E4%BC%98%E6%83%A0%E7%AD%96%E7%95%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
                                                               图	获取订单匹配的优惠策略的顺序图

下图表明了互联网酒店预订系统中，当酒店管理人员或网站营销人员需要添加满减优惠策略时，相关对象之间的协作。

![添加满减优惠策略的顺序图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E6%B7%BB%E5%8A%A0%E6%BB%A1%E5%87%8F%E7%AD%96%E7%95%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
                                                               图	添加满减优惠策略的顺序图

（5）业务逻辑层的设计原理

bl.coupon是服务器端提供的业务逻辑接口，blImpl.coupon是接口的实现，blImpl通过数据层接口data.coupon.CouponMapper来访问数据库，从而实现数据读取和持久化存储。

（6）重要的数据结构及算法

couponVO: coupon的展示层对象。包含的数据有

```java
private Integer hotelId;
private Integer id;
private String description;
private Integer status;
private String name;
private Integer type;
```



#### 4.2.3 blImpl.hotel模块

（1）模块概述

blImpl.hotel模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.hotel模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

 ![hotel](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/blImpl.hotel.png)

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|bl.hotel.HotelService.addHotel| **语法:** Integer addHotel(HotelVO hotelVO,int adminId) throws ServiceException|
|        | **前置条件:** hotelVO中信息格式均无误且由管理人员操作 |
|        | **后置条件:** 以hotelVO中信息添加酒店 |
|bl.hotel.HotelService.deleteHotel| **语法:** ResponseVO deleteHotel(Integer hotelId, Integer adminId) |
|        | **前置条件:** 由管理人员操作 |
|        | **后置条件:** 删除指定酒店 |
|bl.hotel.HotelService.addHotelManager| **语法:** ResponseVO addHotelManager(Integer hotelId, Integer managerId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 修改指定酒店的工作人员Id |
|bl.hotel.HotelService.updateHotelDetail| **语法:** ResponseVO updateHotelDetail(HotelDetail hotelDetail,int hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 修改指定酒店的信息 |
|bl.hotel.HotelService.updateRoomInfo| **语法:** void updateRoomInfo(Integer hotelId, String roomType,Integer rooms) throws ServiceException|
|        | **前置条件:** 线上预订成功或线下入住或线下退房 |
|        | **后置条件:** 查找指定酒店中指定类型的客房，修改其剩余客房信息 |
|bl.hotel.HotelService.retrieveHotels| **语法:** List&lt;HotelVO&gt; retrieveHotels() |
|        | **前置条件:** 无 |
|        | **后置条件:** 列表获取酒店信息 |
|bl.hotel.HotelService.retrieveHotelDetails| **语法:** HotelVO retrieveHotelDetails(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店，返回其详细信息 |
|bl.hotel.HotelService.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId,String roomType) throws ServiceException |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店的指定类型房间，返回其剩余数量 |
|bl.hotel.HotelService.insertRoomInfo| **语法:** ResponseVO insertRoomInfo(HotelRoom hotelRoom) |
|        | **前置条件:** 无 |
|        | **后置条件:** 添加指定的酒店客房信息 |
|bl.hotel.RoomService.retrieveHotelRoomInfo| **语法:** List&lt;HotelRoom&gt; retrieveHotelRoomInfo(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店，返回其全部房间信息 |
|bl.hotel.RoomService.insertRoomInfo| **语法:** void insertRoomInfo(HotelRoom hotelRoom) |
|        | **前置条件:** 无 |
|        | **后置条件:** 添加指定的酒店客房信息 |
|bl.hotel.RoomService.updateRoomInfo| **语法:** void updateRoomInfo(Integer hotelId, String roomType, Integer rooms) |
|        | **前置条件:** 线上预订成功或线下入住或线下退房 |
|        | **后置条件:** 查找指定酒店的指定类型客房，更新其数量 |
|bl.hotel.RoomService.updateRoomBase| **语法:** ResponseVO updateRoomBase(HotelRoom Base) throws ServiceException|
|        | **前置条件:** 酒店工作人员需要修改酒店房间的信息 |
|        | **后置条件:** 查找指定酒店的指定类型客房，更新其基本信息 |
|bl.hotel.RoomService.deleteRoomInfo| **语法:** void deleteRoomInfo(Integer hotelId, String roomType) |
|        | **前置条件:** 无 |
|        | **后置条件:** 删除指定酒店的指定类型客房 |
|bl.hotel.RoomService.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId, String roomType) |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找指定酒店的指定类型房间，返回其剩余数量 |

需要的服务

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| data.hotel.HotelMapper.insertHotel(Hotel hotel) | 插入单一持久化对象 |
| data.hotel.HotelMapper.deletehotel(int hotelId) | 删除根据id查找到的单一持久化对象 |
| data.hotel.HotelMapper.updateHotelManager(Integer hotelId, Integer managerId) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.hotel.HotelMapper.updateHotelDetail(Integer hotelId, String address, String bizRegion, String hotelStar, String hotelService, String description, String phoneNum) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.hotel.HotelMapper.selectAllHotel() | 查找多个持久化对象 |
| data.hotel.HotelMapper.selectById(Integer id) | 根据ID进行查找单一持久化对象 |
| data.hotel.RoomMapper.selectRoomsByHotelId(Integer hotelId) | 根据ID进行查找多个持久化对象 |
| data.hotel.RoomMapper.insertRoom(HotelRoom hotelRoom) | 插入单一持久化对象 |
| data.hotel.RoomMapper.updateRoomInfo(Integer hotelId, RoomType roomType, Integer curNum) | 根据curNum改变根据hotelID与roomType查找到的单一持久化对象的属性 |
| data.hotel.RoomMapper.updateRoomBase(HotelRoom hotelRoom) | 根据curNum、total、price改变根据hotelID与roomType查找到的单一持久化对象的属性 |
| data.hotel.RoomMapper.getRoomCurNum(Integer hotelId, RoomType roomType) | 得到根据hotelId与roomType查找到的单一持久化对象的属性 |
| data.hotel.RoomMapper.deleteRoom(Integer hotelId, RoomType roomType) | 删除单一持久化对象 |

（4）业务逻辑层的动态模型

下图举例当获得酒店详细信息时，业务逻辑处理的相关对象之间的协作。

![hotel业务逻辑](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/hotel%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91.png)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。

#### 4.2.4 blImpl.order模块

（1）模块概述

blImpl.order模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.order模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

![order模块整体结构图.png](https://i.loli.net/2020/06/17/l8scyUfoKihMXav.png)

（3）模块内部类的接口规范

提供的服务

| 接口名                                   |                                                              |
| ---------------------------------------- | :----------------------------------------------------------- |
| bl.order.OrderService.addOrder           | **语法:** ResponseVO addOrder(OrderVO orderVO)               |
|                                          | **前置条件:** 订单信息填写完整                               |
|                                          | **后置条件:** 添加订单并更新酒店剩余房间信息，并开始异常订单的计时，返回预订成功与否的结果 |
| bl.order.OrderService.getAllOrders       | **语法:** List&lt;Order&gt; getAllOrders()                   |
|                                          | **前置条件:** 无                                             |
|                                          | **后置条件:** 获得所有订单信息                               |
| bl.order.OrderService.getUserOrders      | **语法:** List&lt;Order&gt; getUserOrders(int userid)        |
|                                          | **前置条件:** 无                                             |
|                                          | **后置条件:** 查找用户，返回其所有订单信息                   |
| bl.order.OrderService.annulBookedOrder   | **语法:** ResponseVO annulBookedOrder(int orderid)           |
|                                          | **前置条件:** 客户在最晚执行时间前撤销未执行订单             |
|                                          | **后置条件:** 撤销订单并更新酒店剩余房间等信息，按条件更新用户信用，返回撤销成功与否的结果 |
| bl.order.OrderService.annulOrder   | **语法:** void annulOrder(int orderid) throws ServiceException                      |
|                                          | **前置条件:** 无                                             |
|                                          | **后置条件:** 撤销订单并更新酒店剩余房间等信息               |
| bl.order.OrderService.abnormalOrder      | **语法:** void abnormalOrder(int orderid) throws ServiceException                   |
|                                          | **前置条件:** 订单预订成功后在超过最晚订单执行时间后还没有执行 |
|                                          | **后置条件:** 将订单状态置为“异常”，并为用户扣除等于订单总价值的信用值 |
| bl.order.OrderService.solveAbnormalOrder | **语法:** ResponseVO solveAbnormalOrder(int orderid)         |
|                                          | **前置条件:** 异常订单在离店时间时仍未被置为已执行或已撤销   |
|                                          | **后置条件:** 将订单状态置为“过期异常”，并恢复房间           |
| bl.order.OrderService.excuteOrder        | **语法:** ResponseVO excuteOrder(int orderid)                |
|                                          | **前置条件:** 酒店工作人员要为入住客户执行“未执行”或“异常”的订单 |
|                                          | **后置条件:** 执行订单，并为用户加上等同于订单总价值的信用值，返回执行成功与否的结果 |
| bl.order.OrderService.leaveEarly         | **语法:** ResponseVO leaveEarly(int orderid)                 |
|                                          | **前置条件:** 当前日期早于订单结束日期                       |
|                                          | **后置条件:** 修改订单的结束日期为当前日期，重新计算并更改价格，返回执行成功与否的结果 |
| bl.order.OrderService.getHotelOrders     | **语法:** List&lt;Order&gt; getHotelOrders(Integer hotelId)  |
|                                          | **前置条件:** 无                                             |
|                                          | **后置条件:** 查找指定酒店，返回其所有订单                   |

​                                                                                         

需要的服务

|                            服务名                            | 服务                                            |
| :----------------------------------------------------------: | ----------------------------------------------- |
| bl.hotel.HotelService.getRoomCurNum(Integer hotelId,String roomType) | 查看指定酒店的指定房间的剩余数量                |
| bl.hotel.HotelService.updateRoomInfo(Integer hotelId, String roomType,Integer rooms) | 修改指定酒店的指定类型客房的剩余数量            |
|          bl.user.AccountService.getUserInfo(int id)          | 获取用户个人信息                                |
| bl.vip.VIPService.updateClientCredit(int userId, double credit) | 增减用户信用值                                  |
|         data.order.OrderMapper.addOrder(Order order)         | 插入单一持久化对象                              |
| data.order.OrderMapper.updateOrder(Integer orderId, String checkOutDate, Double price) | 改变根据order中的ID查找到的单一持久化对象的属性 |
|            data.order.OrderMapper.getAllOrders()             | 查找多个持久化对象                              |
|       data.order.OrderMapper.getUserOrders(int userid)       | 根据ID进行查找多个持久化对象                    |
|       data.order.OrderMapper.getOrderById(int orderid)       | 根据ID进行查找单一持久化对象                    |
|        data.order.OrderMapper.annulOrder(int orderid)        | 改变根据ID查找到的单一持久化对象的属性          |
|       data.order.OrderMapper.excuteOrder(int orderid)        | 改变根据ID查找到的单一持久化对象的属性          |
|      data.order.OrderMapper.abnormalOrder(int orderid)       | 改变根据ID查找到的单一持久化对象的属性          |
|    data.order.OrderMapper.solveAbnormalOrder(int orderid)    | 改变根据ID查找到的单一持久化对象的属性          |


（4）业务逻辑层的动态模型

下图举例当获得订单详细信息时，业务逻辑处理的相关对象之间的协作。

![order业务逻辑层动态模型.jpg](https://i.loli.net/2020/06/17/xTV7NFlZKtMzn2U.jpg)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。

#### 4.2.5 blImpl.user模块

（1）模块概述

blImpl.user模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.user模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

 ![user](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/blImpl.user.png)

（3）模块内部类的接口规范

提供的服务

| 接口名                                  |                                                              |
| --------------------------------------- | :----------------------------------------------------------- |
| bl.user.AccountService.registerAccount  | **语法:** ResponseVO registerAccount(UserVO userVO)          |
|                                         | **前置条件:** UserVO中信息均符合格式                         |
|                                         | **后置条件:** 以UserVO中信息注册账号，返回注册成功与否的结果 |
| bl.user.AccountService.login            | **语法:** User login(UserForm userForm)                      |
|                                         | **前置条件:** userForm中信息均符合格式                       |
|                                         | **后置条件:** 根据userForm查找用户并验证，登录成功会将用户信息保存在session中，返回登陆验证的结果 |
| bl.user.AccountService.getUserInfo      | **语法:** User getUserInfo(int id)                           |
|                                         | **前置条件:** 无                                             |
|                                         | **后置条件:** 查找用户，返回其个人信息                       |
| bl.user.AccountService.updateUserInfo   | **语法:** ResponseVO updateUserInfo(int id, String password,String username,String phonenumber) |
|                                         | **前置条件:** 输入信息均符合格式                             |
|                                         | **后置条件:** 根据输入查找用户并更新其个人信息，返回更新成功与否的结果 |
| bl.user.AccountService.updateUserCredit | **语法:** void updateUserCredit(int id, double credit)       |
|                                         | **前置条件:** 输入信息均符合格式                             |
|                                         | **后置条件:** 根据输入查找用户并更新其信用值，返回更新成功与否的结果 |

需要的服务

|                            服务名                            | 服务                                   |
| :----------------------------------------------------------: | -------------------------------------- |
|     data.user.AccountMapper.createNewAccount(User user)      | 插入单一持久化对象                     |
|    data.user.AccountMapper.getAccountByName(String email)    | 根据email查找单一持久化对象            |
|        data.user.AccountMapper.getAccountById(int id)        | 根据ID进行查找单一持久化对象           |
| data.user.AccountMapper.updateAccount(int id, String password, String username, String phonenumber) | 改变根据ID查找到的单一持久化对象的属性 |
| data.user.AccountMapper.updateAccountCredit(int id, double credit) | 改变根据ID查找到的单一持久化对象的属性 |

（4）业务逻辑层的动态模型

下图举例当获得用户详细信息时，业务逻辑处理的相关对象之间的协作。

![user业务逻辑](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/user%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91.png)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。



#### 4.2.6 blImpl.VIP模块

（1）模块概述

blImpl.VIP模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.VIP模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

![VIP模块整体结构图.png](https://i.loli.net/2020/06/17/tsHXEfNg7wRkYni.png)

（3）模块内部类的接口规范

提供的服务

| 接口名                               |                                                              |
| ------------------------------------ | :----------------------------------------------------------- |
| bl.vip.VIPService.registerVIP        | **语法:** ResponseVO registerVIP(VIPVO vipVO)                |
|                                      | **前置条件:** VIPUserVO中信息均符合格式                      |
|                                      | **后置条件:** 以VIPUserVO中信息注册会员，返回注册成功与否的结果 |
| bl.vip.VIPService.getVIPInfo         | **语法:** VIP getVIPInfo(int userId)                       |
|                                      | **前置条件:** 无                                             |
|                                      | **后置条件:** 以userId查找会员，返回会员信息                 |
| bl.vip.VIPService.updateClientCredit | **语法:** void updateClientCredit(int userId, double credit) throws ServiceException |
|                                      | **前置条件:** 无                                             |
|                                      | **后置条件:** 根据输入查找用户并更新其信用值                 |
| bl.vip.VIPService.updateVIPLevel     | **语法:** void updateVIPLevel(int userId)                    |
|                                      | **前置条件:** 无                                             |
|                                      | **后置条件:** 根据会员用户当前信用值更新其会员等级           |
| bl.vip.VIPService.setVIPLevel        | **语法:** void setVIPLevel(int vipId, VIPLevel level)          |
|                                      | **前置条件:** 无                                             |
|                                      | **后置条件:** 设置会员用户的等级                             |

需要的服务

|                            服务名                            | 服务                                   |
| :----------------------------------------------------------: | -------------------------------------- |
|          bl.user.AccountService.getUserInfo(int id)          | 根据ID查找用户信息                     |
| bl.user.AccountService.updateUserCredit(int id, double credit) | 根据ID与credit更新用户的信用值         |
|           data.vip.VIPMapper.createNewVIP(VIP vip)           | 插入单一持久化对象                     |
|        data.vip.VIPMapper.getVIPByUserId(int userId)         | 根据userId进行查找单一持久化对象       |
|  data.vip.VIPMapper.setVIPLevel(int vipId, VIPLevel level)   | 改变根据ID查找到的单一持久化对象的属性 |

（4）业务逻辑层的动态模型

下图举例当获得VIP详细信息时，业务逻辑处理的相关对象之间的协作。

![VIP业务逻辑层动态模型.jpg](https://i.loli.net/2020/06/17/trA6vgiIOHcGweZ.jpg)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。

#### 4.2.7 blImpl.marketer模块

（1）模块概述

blImpl.marketer模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.marketer模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

 ![marketer模块整体结构图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/blImpl.marketer%E6%A8%A1%E5%9D%97%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1.png)

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|bl.marketer.MarketerService.getAbnormalOrders| **语法:** List&lt;Order&gt; getAbnormalOrders() |
|        | **前置条件:** 无 |
|        | **后置条件:** 查找所有异常订单 |
|bl.marketer.MarketerService.annulAbnormalOrder| **语法:** ResponseVO annulAbnormalOrder(int orderid, double percent) |
|        | **前置条件:** 订单异常 |
|        | **后置条件:** 撤销订单，并为用户恢复订单总价值乘以percent的信用值，恢复房间，返回撤销成功与否的结果 |
|bl.marketer.MarketerService.buyCredit| **语法:** ResponseVO buyCredit(String email, double credit) |
|        | **前置条件:** 输入的账号存在 |
|        | **后置条件:** 根据账号查找用户并增加其信用值，返回更新成功与否的结果 |


需要的服务

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| bl.order.OrderService.annulOrder(int orderid) | 撤销订单以及恢复房间 |
| bl.vip.VIPService.updateClientCredit(int userId, double credit) | 增减用户信用值 |
| data.order.OrderMapper.getOrderById(int orderid) | 根据ID进行查找单一持久化对象 |
| data.user.AccountMapper.getAccountByName(String email) | 根据email查找单一持久化对象 |
| data.marketer.MarketerMapper.getAllAbnormalOrders() | 查找多个持久化对象 |

（4）业务逻辑层的动态模型

下图举例当获取所有异常订单时，业务逻辑处理的相关对象之间的协作。

![marketer业务逻辑层动态模型](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E5%BC%82%E5%B8%B8%E8%AE%A2%E5%8D%95%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。

#### 4.2.8 blImpl.rar模块

（1）模块概述

blImpl.rar模块承担的需求参见需求规格文档功能需求和相关非功能需求。

blImpl.rar模块的职责及接口参见软件体系结构文档表。

（2）整体结构

业务逻辑层分为 2 个子层： 一个是 bl 层， 一个是 blImpl 层。bl层主要负责向界面层提供服务， 并且利用具体的 blImpl 来实现各个服务。

 ![rar模块整体结构图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/blImpl.rar%E6%A8%A1%E5%9D%97%E7%B1%BB%E7%9A%84%E8%AE%BE%E8%AE%A1.png)

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|bl.rar.RARService.rateAndReview| **语法:** ResponseVO rateAndReview(Integer orderId, double rate, String review) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为每个订单添加评论 |
|bl.rar.RARService.calHotelRate| **语法:** void calHotelRate(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为指定酒店更新评分 |
|bl.rar.RARService.getHotelRAR| **语法:** List&lt;Judgment&gt; getHotelRAR(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 为指定酒店获取评价列表 |


需要的服务

|         服务名         | 服务                   |
| :--------------------: | ---------------------- |
| data.order.OrderMapper.getOrderById(int orderid) | 根据ID进行查找单一持久化对象 |
| data.order.OrderMapper.orderRAR(int orderid) | 改变根据ID进行查找到的单一持久化对象的属性 |
| data.rar.RARMapper.insertRAR(Judgment judgment) | 插入单一持久化对象 |
| data.rar.RARMapper.updateHotelRate(Integer hotelId, Double rate) | 改变根据hotelID查找到的单一持久化对象的属性 |
| data.rar.RARMapper.selectRARByHotelId(Integer hotelId) | 根据hotelID进行查找多个持久化对象 |

（4）业务逻辑层的动态模型

下图举例当客户评价时，业务逻辑处理的相关对象之间的协作。

![rar业务逻辑层动态模型](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/%E5%AE%A2%E6%88%B7%E8%AF%84%E4%BB%B7%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

（5）业务逻辑层的设计原理

利用委托式控制风格， 每个界面需要访问的业务逻辑有各自的控制器委托给不同的领域对象。

### 4.3 数据层的分解
#### 4.3.1 data.admin模块

（1）模块概述

data.admin模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.admin模块的职责及接口参见软件体系结构文档表26,27

（2）整体结构

根据体系结构的设计，我们将系统分为展示层，业务逻辑层和数据层。为了提高每一层的灵活性，我们在相邻两层之间添加了接口。对于dataImpl.admin，我们在业务逻辑层和数据层之间添加了data.admin.AdminMapper接口。po.*是作为admin的持久化对象被加入到设计模型中去的。

data.admin模块的设计如下图所示
![dataImpl.admin模块的设计](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/dataImpl.admin%E7%9A%84%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

​                                                               图	data.admin模块的设计


data.admin模块的职责如下表：

|    模块    |                             职责                             |
| :--------: | :----------------------------------------------------------: |
| data.admin | 负责新加酒店工作人员、获得用户信息列表、增加酒店、修改客户信息的数据持久化 |

​                                                                                               表	data.admin模块的职责

（3）模块内部类的接口规范

提供的服务（供接口）：

| 接口名                                 |                                                        |
| -------------------------------------- | :----------------------------------------------------- |
| data.admin.AdminMapper.addManager      | **语法:** int addManager(User user)                    |
|                                        | **前置条件:** 同样ID的user在数据库中不存在             |
|                                        | **后置条件:** 在数据库中增加一个user记录并返回id属性   |
| data.admin.AdminMapper.addMarketer     | **语法:** int addMarketer(User user)                   |
|                                        | **前置条件:** 同样ID的user在数据库中不存在             |
|                                        | **后置条件:** 在数据库中增加一个user记录               |
| data.admin.AdminMapper.getAllManagers  | **语法:** List&lt;User&gt; getAllManagers()            |
|                                        | **前置条件:** 无                                       |
|                                        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |
| data.admin.AdminMapper.getAllMarketers | **语法:** List&lt;User&gt; getAllMarketers()           |
|                                        | **前置条件:** 无                                       |
|                                        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |
| data.admin.AdminMapper.getAllClients   | **语法:** List&lt;User&gt; getAllClients()             |
|                                        | **前置条件:** 无                                       |
|                                        | **后置条件:** 查找数据库返回相应的List&lt;User&gt;结果 |

​                                                                                               表	data.admin模块的接口规范

（4）数据层的设计原理

数据持久化采用mysql数据库，采用mysql来实现数据库操作。

#### 4.3.2 data.coupon模块

（1）模块概述

data.coupon模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.coupon模块的职责及接口参见软件体系结构文档表26,28。

（2）整体结构

根据体系结构的设计，我们将系统分为展示层，业务逻辑层和数据层。为了提高每一层的灵活性，我们在相邻两层之间添加了接口。对于dataImpl.coupon，我们在业务逻辑层和数据层之间添加了data.coupon.CouponMapper接口。po.*是作为coupon的持久化对象被加入到设计模型中去的。

data.coupon模块的设计如下图所示
![dataImpl.coupon模块的设计](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/dataImpl.coupon%E7%9A%84%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

​                                                               图	datat.coupon模块的设计

data.coupon模块的职责如下表：

|    模块     |                   职责                   |
| :---------: | :--------------------------------------: |
| data.coupon | 负责新加优惠策略，获取某酒店的所有优惠券 |

​                                                                                               表	data.coupon模块的职责

（3）模块内部类的接口规范

提供的服务（供接口）

| 接口名 |         |
| ------ | :----------- |
|data.coupon.CouponMapper.insertCoupon| **语法:** int insertCoupon(Coupon coupon)|
|        | **前置条件:** 同样ID的coupon在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个coupon记录 |
|data.coupon.CouponMapper.selectByHotelId| **语法:** List&lt;Coupon&gt; selectByHotelId(Integer hotelId) |
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelID进行查找返回相应的List&lt;Coupon&gt;结果 |
|data.coupon.CouponMapper.deleteCoupon| **语法:** int deleteCoupon(Integer id)|
|        | **前置条件:** 同样ID的coupon在数据库中不存在 |
|        | **后置条件:** 在数据库中删除一个coupon记录 |

​                                                                                               表	data.coupon模块的接口规范

（4）数据层的设计原理

数据持久化采用mysql数据库，采用mysql来实现数据库操作。

#### 4.3.3 data.hotel模块

（1）模块概述

data.hotel模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.hotel模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.hotel 接口提供。

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|data.hotel.HotelMapper.insertHotel| **语法:** int insertHotel(Hotel hotel)|
|        | **前置条件:** 同样ID的hotel在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个hotel记录 |
|data.hotel.HotelMapper.updateHotelManager| **语法:** int updateHotelManager(Integer hotelId, Integer managerId)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的manageId属性 |
|data.hotel.HotelMapper.updateHotelDetail| **语法:** int updateHotelDetail(Integer hotelId, String address, String bizRegion, String hotelStar, String hotelServiice, String description, String phoneNum)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的address、bizRegion、hotelStar、hotelService、description、phoneNum属性 |
|data.hotel.HotelMapper.selectAllHotel| **语法:** List&lt;HotelVO&gt; selectAllHotel()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;HotelVO&gt;结果 |
|data.hotel.HotelMapper.selectById| **语法:** HotelVO selectById(Integer id)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按id进行查找返回相应的HotelVO结果 |
|data.hotel.HotelMapper.deleteHotel| **语法:** int deleteHotel(Integer hotelId)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 在数据库中删除一个hotel记录 |
|data.hotel.RoomMapper.updateRoomInfo| **语法:** int updateRoomInfo(Integer hotelId, RoomType roomType, Integer curNum)|
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 更新该HotelRoom记录的curNum属性 |
|data.hotel.RoomMapper.updateRoomInfo| **语法:** int updateRoomInfo(HotelRoom hotelRoom) |
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 更新该HotelRoom记录的curNum、total、price属性 |
|data.hotel.RoomMapper.insertRoom| **语法:** int insertRoom(HotelRoom hotelRoom)|
|        | **前置条件:** 同样hotelId与roomType的HotelRoom记录在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个hotelRoom记录 |
|data.hotel.RoomMapper.deleteRoom| **语法:** int deleteRoom(Integer hotelId, RoomType roomType)|
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 在数据库中删除一个hotelRoom记录 |
|data.hotel.RoomMapper.selectRoomsByHotelId| **语法:** List&lt;HotelRoom&gt; selectRoomsByHotelId(Integer hotelId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelId进行查找返回相应的List&lt;HotelRoom&gt;结果 |
|data.hotel.RoomMapper.getRoomCurNum| **语法:** int getRoomCurNum(Integer hotelId, RoomType roomType) |
|        | **前置条件:** 在数据库中存在同样hotelId与roomType的HotelRoom记录 |
|        | **后置条件:** 返回该HotelRoom记录的curNum属性 |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。

#### 4.3.4 data.order模块

（1）模块概述

data.order模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.order模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.order 接口提供。

（3）模块内部类的接口规范

提供的服务



| 接口名                                    |                                                              |
| ----------------------------------------- | :----------------------------------------------------------- |
| data.order.OrderMapper.addOrder           | **语法:** int addOrder(Order order)                          |
|                                           | **前置条件:** 同样ID的order在数据库中不存在                  |
|                                           | **后置条件:** 在数据库中增加一个order记录                    |
| data.order.OrderMapper.updateOrder        | **语法:** int updateOrder(Integer orderId, String checkOutDate, Double price) |
|                                           | **前置条件:** 在数据库中存在同样orderid的Order记录           |
|                                           | **后置条件:** 更新该Order记录的checkOutDate、price属性       |
| data.order.OrderMapper.getAllOrders       | **语法:** List&lt;Order&gt; getAllOrders()                   |
|                                           | **前置条件:** 无                                             |
|                                           | **后置条件:** 查找数据库返回相应的List&lt;Order&gt;结果      |
| data.order.OrderMapper.getUserOrders      | **语法:** List&lt;Order&gt; selectById(Integer userId)       |
|                                           | **前置条件:** 无                                             |
|                                           | **后置条件:** 按userId进行查找返回相应的List&lt;Order&gt;结果 |
| data.order.OrderMapper.getOrderById       | **语法:** Order getOrderById(int orderid)                    |
|                                           | **前置条件:** 无                                             |
|                                           | **后置条件:** 按orderid进行查找返回相应的Order结果           |
| data.order.OrderMapper.annulOrder         | **语法:** int annulOrder(int orderid)                        |
|                                           | **前置条件:** 在数据库中存在同样orderid的Order记录           |
|                                           | **后置条件:** 更新该Order记录的orderState属性为“已撤销”      |
| data.order.OrderMapper.excuteOrder        | **语法:** int excuteOrder(int orderid)                       |
|                                           | **前置条件:** 在数据库中存在同样orderid的Order记录           |
|                                           | **后置条件:** 更新该Order记录的orderState属性为“已执行”      |
| data.order.OrderMapper.abnormalOrder      | **语法:** int abnormalOrder(int orderid)                     |
|                                           | **前置条件:** 在数据库中存在同样orderid的Order记录           |
|                                           | **后置条件:** 更新该Order记录的orderState属性为“异常”        |
| data.order.OrderMapper.solveAbnormalOrder | **语法:** int solveAbnormalOrder(int orderid)                |
|                                           | **前置条件:** 在数据库中存在同样orderid的Order记录           |
|                                           | **后置条件:** 更新该Order记录的orderState属性为“过期异常”    |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。

#### 4.3.5 data.user模块

（1）模块概述

data.user模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.user模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.user 接口提供。

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|data.user.AccountMapper.createNewAccount| **语法:** int createNewAccount(User user)|
|        | **前置条件:** 同样ID的user在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个user记录 |
|data.user.AccountMapper.getAccountByName| **语法:** User getAccountByName(String email)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按email进行查找返回相应的User结果 |
|data.user.AccountMapper.getAccountById| **语法:** User getAccountById(int id)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按id进行查找返回相应的User结果 |
|data.user.AccountMapper.deleteAccountById| **语法:** int deleteAccountById(int id)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 在数据库中删除一个User记录 |
|data.user.AccountMapper.updateAccount| **语法:** int updateAccount(int id, String password, String username, String phonenumber)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 更新该User记录的password、username、phonenumber属性 |
|data.user.AccountMapper.updateAccountCredit| **语法:** int updateAccountCredit(int id, double credit)|
|        | **前置条件:** 在数据库中存在同样id的User记录 |
|        | **后置条件:** 更新该User记录的credit属性 |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。



#### 4.3.6 data.VIP模块

（1）模块概述

data.VIP模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.VIP模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.VIP 接口提供。

（3）模块内部类的接口规范

提供的服务

| 接口名                            |                                                      |
| --------------------------------- | :--------------------------------------------------- |
| data.vip.VIPMapper.createNewVIP   | **语法:** int createNewVIP(VIP vip)                  |
|                                   | **前置条件:** 同样ID的vip在数据库中不存在            |
|                                   | **后置条件:** 在数据库中增加一个vip记录              |
| data.vip.VIPMapper.getVIPByUserId | **语法:** VIP getVIPByUserId(int userId)             |
|                                   | **前置条件:** 无                                     |
|                                   | **后置条件:** 按userId进行查找返回相应的VIP结果      |
| data.vip.VIPMapper.setVIPLevel    | **语法:** int setVIPLevel(int vipId, VIPLevel level) |
|                                   | **前置条件:** 在数据库中存在同样id的VIP记录          |
|                                   | **后置条件:** 更新该User记录的level属性              |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。

#### 4.3.7 data.marketer模块

（1）模块概述

data.marketer模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.marketer模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.marketer接口提供。

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|data.marketer.MarketerMapper.getAllAbnormalOrders| **语法:** List&lt;Order&gt; getAllAbnormalOrders()|
|        | **前置条件:** 无 |
|        | **后置条件:** 查找数据库返回相应的List&lt;Order&gt;结果 |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。

#### 4.3.8 data.rar模块

（1）模块概述

data.rar模块承担的需求参见需求规格文档功能需求和相关非功能需求。

data.rar模块的职责及接口参见软件体系结构文档表。

（2）整体结构

数据层主要提供给数据映射层服务。 对于持久化数据的集体载入、 集体保存、 增、 删、改、 查。 这些服务由 data.rar接口提供。

（3）模块内部类的接口规范

提供的服务

| 接口名 |         |
| ------ | :----------- |
|data.rar.RARMapper.insertRAR| **语法:** int insertRAR(Judgment judgment)|
|        | **前置条件:** 同样orderId的Judgment记录在数据库中不存在 |
|        | **后置条件:** 在数据库中增加一个Judgment记录 |
|data.rar.RARMapper.updateHotelRate| **语法:** int updateHotelRate(Integer hotelId, Double rate)|
|        | **前置条件:** 在数据库中存在同样hotelId的hotel记录 |
|        | **后置条件:** 更新该hotel记录的rate属性 |
|data.rar.RARMapper.selectRARByHotelId| **语法:** List&lt;Judgment&gt; selectRARByHotelId(Integer hotelId)|
|        | **前置条件:** 无 |
|        | **后置条件:** 按hotelId进行查找返回相应的List&lt;Judgment&gt;结果 |
|data.order.OrderMapper.orderRAR| **语法:** int orderRAR(int orderid)|
|        | **前置条件:** 在数据库中存在同样orderid的Order记录 |
|        | **后置条件:** 更新该Order记录的rar属性为false |


（4）业务逻辑层的设计原理

利用dataImpl接口对数据库的实现提供很好的可修改性。

## 5. 依赖视角

下图为客户端和服务器端各自的包之间的依赖关系

![前端开发包图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE%EF%BC%88%E6%96%B0%EF%BC%89.png)
                                                               图	互联网预订酒店系统前端开发包图

![后端开发包图](https://njuse.oss-cn-shenzhen.aliyuncs.com/%E8%BD%AF%E5%B7%A5%E4%BA%8C%E6%9C%80%E7%BB%88%E9%98%B6%E6%AE%B5%E4%B8%93%E5%B1%9E/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E6%96%87%E6%A1%A3/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE%EF%BC%88%E6%96%B0%EF%BC%89.png)
                                                                图	互联网预订酒店系统后端开发包图

## 6. 变更记录

| 修改人员 | 日期          |
| :------: | ------------- |
|  曾昭宁  | 2020年6月15日 |
|  陈鹏克  | 2020年6月16日 |
|  陈鹏克  | 2020年6月16日 |
|  浦隽轩  | 2020年6月17日 |
|   檀潮   | 2020年6月18日 |
|  曾昭宁  | 2020年6月18日 |
|  曾昭宁  | 2020年6月29日 |